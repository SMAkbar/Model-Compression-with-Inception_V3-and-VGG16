
## IMPORTING TENSORFLOW


```python
# Import all the necessary files!
import os
import tensorflow as tf
from tensorflow.keras import layers
from tensorflow.keras import Model
```

## IMPORTING INCEPTION_V3
<i> without top layer while using weights of trained model on Image dataset 2015


```python
# Download the inception v3 weights
!wget --no-check-certificate \
    https://storage.googleapis.com/mledu-datasets/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5 \
    -O /tmp/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5

# Import the inception model  
from tensorflow.keras.applications.inception_v3 import InceptionV3

# Create an instance of the inception model from the local pre-trained weights
local_weights_file = '/tmp/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5'

pre_trained_model = InceptionV3(input_shape = (150, 150, 3), 
                                include_top = False, 
                                weights = None)

pre_trained_model.load_weights(local_weights_file)

# Make all the layers in the pre-trained model non-trainable
for layer in pre_trained_model.layers:
  layer.trainable = False
  
# Print the model summary
pre_trained_model.summary()

# Expected Output is extremely large, but should end with:

#batch_normalization_v1_281 (Bat (None, 3, 3, 192)    576         conv2d_281[0][0]                 
#__________________________________________________________________________________________________
#activation_273 (Activation)     (None, 3, 3, 320)    0           batch_normalization_v1_273[0][0] 
#__________________________________________________________________________________________________
#mixed9_1 (Concatenate)          (None, 3, 3, 768)    0           activation_275[0][0]             
#                                                                 activation_276[0][0]             
#__________________________________________________________________________________________________
#concatenate_5 (Concatenate)     (None, 3, 3, 768)    0           activation_279[0][0]             
#                                                                 activation_280[0][0]             
#__________________________________________________________________________________________________
#activation_281 (Activation)     (None, 3, 3, 192)    0           batch_normalization_v1_281[0][0] 
#__________________________________________________________________________________________________
#mixed10 (Concatenate)           (None, 3, 3, 2048)   0           activation_273[0][0]             
#                                                                 mixed9_1[0][0]                   
#                                                                 concatenate_5[0][0]              
#                                                                 activation_281[0][0]             
#==================================================================================================
#Total params: 21,802,784
#Trainable params: 0
#Non-trainable params: 21,802,784
```


```python
last_layer = pre_trained_model.get_layer('mixed7')
print('last layer output shape: ', last_layer.output_shape)
last_output = last_layer.output

# Expected Output:
# ('last layer output shape: ', (None, 7, 7, 768))
```

    last layer output shape:  (None, 7, 7, 768)
    


```python
# Define a Callback class that stops training once accuracy reaches 99.9%
class myCallback(tf.keras.callbacks.Callback):
  def on_epoch_end(self, epoch, logs={}):
    if(logs.get('accuracy')>0.999):
      print("\nReached 99.9% accuracy so cancelling training!")
      self.model.stop_training = True

      
```

## Re-Training


```python
from tensorflow.keras.optimizers import RMSprop

# Flatten the output layer to 1 dimension
x = layers.Flatten()(last_output)
# Add a fully connected layer with 1,024 hidden units and ReLU activation
x = layers.Dense(1024, activation='relu')(x)
# Add a dropout rate of 0.2
x = layers.Dropout(0.2)(x)                  
# Add a final sigmoid layer for classification
x = layers.Dense  (1, activation='sigmoid')(x)           

model = Model( pre_trained_model.input, x) 

model.compile(optimizer = RMSprop(lr=0.0001), 
              loss = 'binary_crossentropy', 
              metrics = ['accuracy'])

model.summary()

# Expected output will be large. Last few lines should be:

# mixed7 (Concatenate)            (None, 7, 7, 768)    0           activation_248[0][0]             
#                                                                  activation_251[0][0]             
#                                                                  activation_256[0][0]             
#                                                                  activation_257[0][0]             
# __________________________________________________________________________________________________
# flatten_4 (Flatten)             (None, 37632)        0           mixed7[0][0]                     
# __________________________________________________________________________________________________
# dense_8 (Dense)                 (None, 1024)         38536192    flatten_4[0][0]                  
# __________________________________________________________________________________________________
# dropout_4 (Dropout)             (None, 1024)         0           dense_8[0][0]                    
# __________________________________________________________________________________________________
# dense_9 (Dense)                 (None, 1)            1025        dropout_4[0][0]                  
# ==================================================================================================
# Total params: 47,512,481
# Trainable params: 38,537,217
# Non-trainable params: 8,975,264

```

    Model: "model"
    __________________________________________________________________________________________________
    Layer (type)                    Output Shape         Param #     Connected to                     
    ==================================================================================================
    input_1 (InputLayer)            [(None, 150, 150, 3) 0                                            
    __________________________________________________________________________________________________
    conv2d (Conv2D)                 (None, 74, 74, 32)   864         input_1[0][0]                    
    __________________________________________________________________________________________________
    batch_normalization (BatchNorma (None, 74, 74, 32)   96          conv2d[0][0]                     
    __________________________________________________________________________________________________
    activation (Activation)         (None, 74, 74, 32)   0           batch_normalization[0][0]        
    __________________________________________________________________________________________________
    conv2d_1 (Conv2D)               (None, 72, 72, 32)   9216        activation[0][0]                 
    __________________________________________________________________________________________________
    batch_normalization_1 (BatchNor (None, 72, 72, 32)   96          conv2d_1[0][0]                   
    __________________________________________________________________________________________________
    activation_1 (Activation)       (None, 72, 72, 32)   0           batch_normalization_1[0][0]      
    __________________________________________________________________________________________________
    conv2d_2 (Conv2D)               (None, 72, 72, 64)   18432       activation_1[0][0]               
    __________________________________________________________________________________________________
    batch_normalization_2 (BatchNor (None, 72, 72, 64)   192         conv2d_2[0][0]                   
    __________________________________________________________________________________________________
    activation_2 (Activation)       (None, 72, 72, 64)   0           batch_normalization_2[0][0]      
    __________________________________________________________________________________________________
    max_pooling2d (MaxPooling2D)    (None, 35, 35, 64)   0           activation_2[0][0]               
    __________________________________________________________________________________________________
    conv2d_3 (Conv2D)               (None, 35, 35, 80)   5120        max_pooling2d[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_3 (BatchNor (None, 35, 35, 80)   240         conv2d_3[0][0]                   
    __________________________________________________________________________________________________
    activation_3 (Activation)       (None, 35, 35, 80)   0           batch_normalization_3[0][0]      
    __________________________________________________________________________________________________
    conv2d_4 (Conv2D)               (None, 33, 33, 192)  138240      activation_3[0][0]               
    __________________________________________________________________________________________________
    batch_normalization_4 (BatchNor (None, 33, 33, 192)  576         conv2d_4[0][0]                   
    __________________________________________________________________________________________________
    activation_4 (Activation)       (None, 33, 33, 192)  0           batch_normalization_4[0][0]      
    __________________________________________________________________________________________________
    max_pooling2d_1 (MaxPooling2D)  (None, 16, 16, 192)  0           activation_4[0][0]               
    __________________________________________________________________________________________________
    conv2d_8 (Conv2D)               (None, 16, 16, 64)   12288       max_pooling2d_1[0][0]            
    __________________________________________________________________________________________________
    batch_normalization_8 (BatchNor (None, 16, 16, 64)   192         conv2d_8[0][0]                   
    __________________________________________________________________________________________________
    activation_8 (Activation)       (None, 16, 16, 64)   0           batch_normalization_8[0][0]      
    __________________________________________________________________________________________________
    conv2d_6 (Conv2D)               (None, 16, 16, 48)   9216        max_pooling2d_1[0][0]            
    __________________________________________________________________________________________________
    conv2d_9 (Conv2D)               (None, 16, 16, 96)   55296       activation_8[0][0]               
    __________________________________________________________________________________________________
    batch_normalization_6 (BatchNor (None, 16, 16, 48)   144         conv2d_6[0][0]                   
    __________________________________________________________________________________________________
    batch_normalization_9 (BatchNor (None, 16, 16, 96)   288         conv2d_9[0][0]                   
    __________________________________________________________________________________________________
    activation_6 (Activation)       (None, 16, 16, 48)   0           batch_normalization_6[0][0]      
    __________________________________________________________________________________________________
    activation_9 (Activation)       (None, 16, 16, 96)   0           batch_normalization_9[0][0]      
    __________________________________________________________________________________________________
    average_pooling2d (AveragePooli (None, 16, 16, 192)  0           max_pooling2d_1[0][0]            
    __________________________________________________________________________________________________
    conv2d_5 (Conv2D)               (None, 16, 16, 64)   12288       max_pooling2d_1[0][0]            
    __________________________________________________________________________________________________
    conv2d_7 (Conv2D)               (None, 16, 16, 64)   76800       activation_6[0][0]               
    __________________________________________________________________________________________________
    conv2d_10 (Conv2D)              (None, 16, 16, 96)   82944       activation_9[0][0]               
    __________________________________________________________________________________________________
    conv2d_11 (Conv2D)              (None, 16, 16, 32)   6144        average_pooling2d[0][0]          
    __________________________________________________________________________________________________
    batch_normalization_5 (BatchNor (None, 16, 16, 64)   192         conv2d_5[0][0]                   
    __________________________________________________________________________________________________
    batch_normalization_7 (BatchNor (None, 16, 16, 64)   192         conv2d_7[0][0]                   
    __________________________________________________________________________________________________
    batch_normalization_10 (BatchNo (None, 16, 16, 96)   288         conv2d_10[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_11 (BatchNo (None, 16, 16, 32)   96          conv2d_11[0][0]                  
    __________________________________________________________________________________________________
    activation_5 (Activation)       (None, 16, 16, 64)   0           batch_normalization_5[0][0]      
    __________________________________________________________________________________________________
    activation_7 (Activation)       (None, 16, 16, 64)   0           batch_normalization_7[0][0]      
    __________________________________________________________________________________________________
    activation_10 (Activation)      (None, 16, 16, 96)   0           batch_normalization_10[0][0]     
    __________________________________________________________________________________________________
    activation_11 (Activation)      (None, 16, 16, 32)   0           batch_normalization_11[0][0]     
    __________________________________________________________________________________________________
    mixed0 (Concatenate)            (None, 16, 16, 256)  0           activation_5[0][0]               
                                                                     activation_7[0][0]               
                                                                     activation_10[0][0]              
                                                                     activation_11[0][0]              
    __________________________________________________________________________________________________
    conv2d_15 (Conv2D)              (None, 16, 16, 64)   16384       mixed0[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_15 (BatchNo (None, 16, 16, 64)   192         conv2d_15[0][0]                  
    __________________________________________________________________________________________________
    activation_15 (Activation)      (None, 16, 16, 64)   0           batch_normalization_15[0][0]     
    __________________________________________________________________________________________________
    conv2d_13 (Conv2D)              (None, 16, 16, 48)   12288       mixed0[0][0]                     
    __________________________________________________________________________________________________
    conv2d_16 (Conv2D)              (None, 16, 16, 96)   55296       activation_15[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_13 (BatchNo (None, 16, 16, 48)   144         conv2d_13[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_16 (BatchNo (None, 16, 16, 96)   288         conv2d_16[0][0]                  
    __________________________________________________________________________________________________
    activation_13 (Activation)      (None, 16, 16, 48)   0           batch_normalization_13[0][0]     
    __________________________________________________________________________________________________
    activation_16 (Activation)      (None, 16, 16, 96)   0           batch_normalization_16[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_1 (AveragePoo (None, 16, 16, 256)  0           mixed0[0][0]                     
    __________________________________________________________________________________________________
    conv2d_12 (Conv2D)              (None, 16, 16, 64)   16384       mixed0[0][0]                     
    __________________________________________________________________________________________________
    conv2d_14 (Conv2D)              (None, 16, 16, 64)   76800       activation_13[0][0]              
    __________________________________________________________________________________________________
    conv2d_17 (Conv2D)              (None, 16, 16, 96)   82944       activation_16[0][0]              
    __________________________________________________________________________________________________
    conv2d_18 (Conv2D)              (None, 16, 16, 64)   16384       average_pooling2d_1[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_12 (BatchNo (None, 16, 16, 64)   192         conv2d_12[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_14 (BatchNo (None, 16, 16, 64)   192         conv2d_14[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_17 (BatchNo (None, 16, 16, 96)   288         conv2d_17[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_18 (BatchNo (None, 16, 16, 64)   192         conv2d_18[0][0]                  
    __________________________________________________________________________________________________
    activation_12 (Activation)      (None, 16, 16, 64)   0           batch_normalization_12[0][0]     
    __________________________________________________________________________________________________
    activation_14 (Activation)      (None, 16, 16, 64)   0           batch_normalization_14[0][0]     
    __________________________________________________________________________________________________
    activation_17 (Activation)      (None, 16, 16, 96)   0           batch_normalization_17[0][0]     
    __________________________________________________________________________________________________
    activation_18 (Activation)      (None, 16, 16, 64)   0           batch_normalization_18[0][0]     
    __________________________________________________________________________________________________
    mixed1 (Concatenate)            (None, 16, 16, 288)  0           activation_12[0][0]              
                                                                     activation_14[0][0]              
                                                                     activation_17[0][0]              
                                                                     activation_18[0][0]              
    __________________________________________________________________________________________________
    conv2d_22 (Conv2D)              (None, 16, 16, 64)   18432       mixed1[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_22 (BatchNo (None, 16, 16, 64)   192         conv2d_22[0][0]                  
    __________________________________________________________________________________________________
    activation_22 (Activation)      (None, 16, 16, 64)   0           batch_normalization_22[0][0]     
    __________________________________________________________________________________________________
    conv2d_20 (Conv2D)              (None, 16, 16, 48)   13824       mixed1[0][0]                     
    __________________________________________________________________________________________________
    conv2d_23 (Conv2D)              (None, 16, 16, 96)   55296       activation_22[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_20 (BatchNo (None, 16, 16, 48)   144         conv2d_20[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_23 (BatchNo (None, 16, 16, 96)   288         conv2d_23[0][0]                  
    __________________________________________________________________________________________________
    activation_20 (Activation)      (None, 16, 16, 48)   0           batch_normalization_20[0][0]     
    __________________________________________________________________________________________________
    activation_23 (Activation)      (None, 16, 16, 96)   0           batch_normalization_23[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_2 (AveragePoo (None, 16, 16, 288)  0           mixed1[0][0]                     
    __________________________________________________________________________________________________
    conv2d_19 (Conv2D)              (None, 16, 16, 64)   18432       mixed1[0][0]                     
    __________________________________________________________________________________________________
    conv2d_21 (Conv2D)              (None, 16, 16, 64)   76800       activation_20[0][0]              
    __________________________________________________________________________________________________
    conv2d_24 (Conv2D)              (None, 16, 16, 96)   82944       activation_23[0][0]              
    __________________________________________________________________________________________________
    conv2d_25 (Conv2D)              (None, 16, 16, 64)   18432       average_pooling2d_2[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_19 (BatchNo (None, 16, 16, 64)   192         conv2d_19[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_21 (BatchNo (None, 16, 16, 64)   192         conv2d_21[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_24 (BatchNo (None, 16, 16, 96)   288         conv2d_24[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_25 (BatchNo (None, 16, 16, 64)   192         conv2d_25[0][0]                  
    __________________________________________________________________________________________________
    activation_19 (Activation)      (None, 16, 16, 64)   0           batch_normalization_19[0][0]     
    __________________________________________________________________________________________________
    activation_21 (Activation)      (None, 16, 16, 64)   0           batch_normalization_21[0][0]     
    __________________________________________________________________________________________________
    activation_24 (Activation)      (None, 16, 16, 96)   0           batch_normalization_24[0][0]     
    __________________________________________________________________________________________________
    activation_25 (Activation)      (None, 16, 16, 64)   0           batch_normalization_25[0][0]     
    __________________________________________________________________________________________________
    mixed2 (Concatenate)            (None, 16, 16, 288)  0           activation_19[0][0]              
                                                                     activation_21[0][0]              
                                                                     activation_24[0][0]              
                                                                     activation_25[0][0]              
    __________________________________________________________________________________________________
    conv2d_27 (Conv2D)              (None, 16, 16, 64)   18432       mixed2[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_27 (BatchNo (None, 16, 16, 64)   192         conv2d_27[0][0]                  
    __________________________________________________________________________________________________
    activation_27 (Activation)      (None, 16, 16, 64)   0           batch_normalization_27[0][0]     
    __________________________________________________________________________________________________
    conv2d_28 (Conv2D)              (None, 16, 16, 96)   55296       activation_27[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_28 (BatchNo (None, 16, 16, 96)   288         conv2d_28[0][0]                  
    __________________________________________________________________________________________________
    activation_28 (Activation)      (None, 16, 16, 96)   0           batch_normalization_28[0][0]     
    __________________________________________________________________________________________________
    conv2d_26 (Conv2D)              (None, 7, 7, 384)    995328      mixed2[0][0]                     
    __________________________________________________________________________________________________
    conv2d_29 (Conv2D)              (None, 7, 7, 96)     82944       activation_28[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_26 (BatchNo (None, 7, 7, 384)    1152        conv2d_26[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_29 (BatchNo (None, 7, 7, 96)     288         conv2d_29[0][0]                  
    __________________________________________________________________________________________________
    activation_26 (Activation)      (None, 7, 7, 384)    0           batch_normalization_26[0][0]     
    __________________________________________________________________________________________________
    activation_29 (Activation)      (None, 7, 7, 96)     0           batch_normalization_29[0][0]     
    __________________________________________________________________________________________________
    max_pooling2d_2 (MaxPooling2D)  (None, 7, 7, 288)    0           mixed2[0][0]                     
    __________________________________________________________________________________________________
    mixed3 (Concatenate)            (None, 7, 7, 768)    0           activation_26[0][0]              
                                                                     activation_29[0][0]              
                                                                     max_pooling2d_2[0][0]            
    __________________________________________________________________________________________________
    conv2d_34 (Conv2D)              (None, 7, 7, 128)    98304       mixed3[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_34 (BatchNo (None, 7, 7, 128)    384         conv2d_34[0][0]                  
    __________________________________________________________________________________________________
    activation_34 (Activation)      (None, 7, 7, 128)    0           batch_normalization_34[0][0]     
    __________________________________________________________________________________________________
    conv2d_35 (Conv2D)              (None, 7, 7, 128)    114688      activation_34[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_35 (BatchNo (None, 7, 7, 128)    384         conv2d_35[0][0]                  
    __________________________________________________________________________________________________
    activation_35 (Activation)      (None, 7, 7, 128)    0           batch_normalization_35[0][0]     
    __________________________________________________________________________________________________
    conv2d_31 (Conv2D)              (None, 7, 7, 128)    98304       mixed3[0][0]                     
    __________________________________________________________________________________________________
    conv2d_36 (Conv2D)              (None, 7, 7, 128)    114688      activation_35[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_31 (BatchNo (None, 7, 7, 128)    384         conv2d_31[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_36 (BatchNo (None, 7, 7, 128)    384         conv2d_36[0][0]                  
    __________________________________________________________________________________________________
    activation_31 (Activation)      (None, 7, 7, 128)    0           batch_normalization_31[0][0]     
    __________________________________________________________________________________________________
    activation_36 (Activation)      (None, 7, 7, 128)    0           batch_normalization_36[0][0]     
    __________________________________________________________________________________________________
    conv2d_32 (Conv2D)              (None, 7, 7, 128)    114688      activation_31[0][0]              
    __________________________________________________________________________________________________
    conv2d_37 (Conv2D)              (None, 7, 7, 128)    114688      activation_36[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_32 (BatchNo (None, 7, 7, 128)    384         conv2d_32[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_37 (BatchNo (None, 7, 7, 128)    384         conv2d_37[0][0]                  
    __________________________________________________________________________________________________
    activation_32 (Activation)      (None, 7, 7, 128)    0           batch_normalization_32[0][0]     
    __________________________________________________________________________________________________
    activation_37 (Activation)      (None, 7, 7, 128)    0           batch_normalization_37[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_3 (AveragePoo (None, 7, 7, 768)    0           mixed3[0][0]                     
    __________________________________________________________________________________________________
    conv2d_30 (Conv2D)              (None, 7, 7, 192)    147456      mixed3[0][0]                     
    __________________________________________________________________________________________________
    conv2d_33 (Conv2D)              (None, 7, 7, 192)    172032      activation_32[0][0]              
    __________________________________________________________________________________________________
    conv2d_38 (Conv2D)              (None, 7, 7, 192)    172032      activation_37[0][0]              
    __________________________________________________________________________________________________
    conv2d_39 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_3[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_30 (BatchNo (None, 7, 7, 192)    576         conv2d_30[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_33 (BatchNo (None, 7, 7, 192)    576         conv2d_33[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_38 (BatchNo (None, 7, 7, 192)    576         conv2d_38[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_39 (BatchNo (None, 7, 7, 192)    576         conv2d_39[0][0]                  
    __________________________________________________________________________________________________
    activation_30 (Activation)      (None, 7, 7, 192)    0           batch_normalization_30[0][0]     
    __________________________________________________________________________________________________
    activation_33 (Activation)      (None, 7, 7, 192)    0           batch_normalization_33[0][0]     
    __________________________________________________________________________________________________
    activation_38 (Activation)      (None, 7, 7, 192)    0           batch_normalization_38[0][0]     
    __________________________________________________________________________________________________
    activation_39 (Activation)      (None, 7, 7, 192)    0           batch_normalization_39[0][0]     
    __________________________________________________________________________________________________
    mixed4 (Concatenate)            (None, 7, 7, 768)    0           activation_30[0][0]              
                                                                     activation_33[0][0]              
                                                                     activation_38[0][0]              
                                                                     activation_39[0][0]              
    __________________________________________________________________________________________________
    conv2d_44 (Conv2D)              (None, 7, 7, 160)    122880      mixed4[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_44 (BatchNo (None, 7, 7, 160)    480         conv2d_44[0][0]                  
    __________________________________________________________________________________________________
    activation_44 (Activation)      (None, 7, 7, 160)    0           batch_normalization_44[0][0]     
    __________________________________________________________________________________________________
    conv2d_45 (Conv2D)              (None, 7, 7, 160)    179200      activation_44[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_45 (BatchNo (None, 7, 7, 160)    480         conv2d_45[0][0]                  
    __________________________________________________________________________________________________
    activation_45 (Activation)      (None, 7, 7, 160)    0           batch_normalization_45[0][0]     
    __________________________________________________________________________________________________
    conv2d_41 (Conv2D)              (None, 7, 7, 160)    122880      mixed4[0][0]                     
    __________________________________________________________________________________________________
    conv2d_46 (Conv2D)              (None, 7, 7, 160)    179200      activation_45[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_41 (BatchNo (None, 7, 7, 160)    480         conv2d_41[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_46 (BatchNo (None, 7, 7, 160)    480         conv2d_46[0][0]                  
    __________________________________________________________________________________________________
    activation_41 (Activation)      (None, 7, 7, 160)    0           batch_normalization_41[0][0]     
    __________________________________________________________________________________________________
    activation_46 (Activation)      (None, 7, 7, 160)    0           batch_normalization_46[0][0]     
    __________________________________________________________________________________________________
    conv2d_42 (Conv2D)              (None, 7, 7, 160)    179200      activation_41[0][0]              
    __________________________________________________________________________________________________
    conv2d_47 (Conv2D)              (None, 7, 7, 160)    179200      activation_46[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_42 (BatchNo (None, 7, 7, 160)    480         conv2d_42[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_47 (BatchNo (None, 7, 7, 160)    480         conv2d_47[0][0]                  
    __________________________________________________________________________________________________
    activation_42 (Activation)      (None, 7, 7, 160)    0           batch_normalization_42[0][0]     
    __________________________________________________________________________________________________
    activation_47 (Activation)      (None, 7, 7, 160)    0           batch_normalization_47[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_4 (AveragePoo (None, 7, 7, 768)    0           mixed4[0][0]                     
    __________________________________________________________________________________________________
    conv2d_40 (Conv2D)              (None, 7, 7, 192)    147456      mixed4[0][0]                     
    __________________________________________________________________________________________________
    conv2d_43 (Conv2D)              (None, 7, 7, 192)    215040      activation_42[0][0]              
    __________________________________________________________________________________________________
    conv2d_48 (Conv2D)              (None, 7, 7, 192)    215040      activation_47[0][0]              
    __________________________________________________________________________________________________
    conv2d_49 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_4[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_40 (BatchNo (None, 7, 7, 192)    576         conv2d_40[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_43 (BatchNo (None, 7, 7, 192)    576         conv2d_43[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_48 (BatchNo (None, 7, 7, 192)    576         conv2d_48[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_49 (BatchNo (None, 7, 7, 192)    576         conv2d_49[0][0]                  
    __________________________________________________________________________________________________
    activation_40 (Activation)      (None, 7, 7, 192)    0           batch_normalization_40[0][0]     
    __________________________________________________________________________________________________
    activation_43 (Activation)      (None, 7, 7, 192)    0           batch_normalization_43[0][0]     
    __________________________________________________________________________________________________
    activation_48 (Activation)      (None, 7, 7, 192)    0           batch_normalization_48[0][0]     
    __________________________________________________________________________________________________
    activation_49 (Activation)      (None, 7, 7, 192)    0           batch_normalization_49[0][0]     
    __________________________________________________________________________________________________
    mixed5 (Concatenate)            (None, 7, 7, 768)    0           activation_40[0][0]              
                                                                     activation_43[0][0]              
                                                                     activation_48[0][0]              
                                                                     activation_49[0][0]              
    __________________________________________________________________________________________________
    conv2d_54 (Conv2D)              (None, 7, 7, 160)    122880      mixed5[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_54 (BatchNo (None, 7, 7, 160)    480         conv2d_54[0][0]                  
    __________________________________________________________________________________________________
    activation_54 (Activation)      (None, 7, 7, 160)    0           batch_normalization_54[0][0]     
    __________________________________________________________________________________________________
    conv2d_55 (Conv2D)              (None, 7, 7, 160)    179200      activation_54[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_55 (BatchNo (None, 7, 7, 160)    480         conv2d_55[0][0]                  
    __________________________________________________________________________________________________
    activation_55 (Activation)      (None, 7, 7, 160)    0           batch_normalization_55[0][0]     
    __________________________________________________________________________________________________
    conv2d_51 (Conv2D)              (None, 7, 7, 160)    122880      mixed5[0][0]                     
    __________________________________________________________________________________________________
    conv2d_56 (Conv2D)              (None, 7, 7, 160)    179200      activation_55[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_51 (BatchNo (None, 7, 7, 160)    480         conv2d_51[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_56 (BatchNo (None, 7, 7, 160)    480         conv2d_56[0][0]                  
    __________________________________________________________________________________________________
    activation_51 (Activation)      (None, 7, 7, 160)    0           batch_normalization_51[0][0]     
    __________________________________________________________________________________________________
    activation_56 (Activation)      (None, 7, 7, 160)    0           batch_normalization_56[0][0]     
    __________________________________________________________________________________________________
    conv2d_52 (Conv2D)              (None, 7, 7, 160)    179200      activation_51[0][0]              
    __________________________________________________________________________________________________
    conv2d_57 (Conv2D)              (None, 7, 7, 160)    179200      activation_56[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_52 (BatchNo (None, 7, 7, 160)    480         conv2d_52[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_57 (BatchNo (None, 7, 7, 160)    480         conv2d_57[0][0]                  
    __________________________________________________________________________________________________
    activation_52 (Activation)      (None, 7, 7, 160)    0           batch_normalization_52[0][0]     
    __________________________________________________________________________________________________
    activation_57 (Activation)      (None, 7, 7, 160)    0           batch_normalization_57[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_5 (AveragePoo (None, 7, 7, 768)    0           mixed5[0][0]                     
    __________________________________________________________________________________________________
    conv2d_50 (Conv2D)              (None, 7, 7, 192)    147456      mixed5[0][0]                     
    __________________________________________________________________________________________________
    conv2d_53 (Conv2D)              (None, 7, 7, 192)    215040      activation_52[0][0]              
    __________________________________________________________________________________________________
    conv2d_58 (Conv2D)              (None, 7, 7, 192)    215040      activation_57[0][0]              
    __________________________________________________________________________________________________
    conv2d_59 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_5[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_50 (BatchNo (None, 7, 7, 192)    576         conv2d_50[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_53 (BatchNo (None, 7, 7, 192)    576         conv2d_53[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_58 (BatchNo (None, 7, 7, 192)    576         conv2d_58[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_59 (BatchNo (None, 7, 7, 192)    576         conv2d_59[0][0]                  
    __________________________________________________________________________________________________
    activation_50 (Activation)      (None, 7, 7, 192)    0           batch_normalization_50[0][0]     
    __________________________________________________________________________________________________
    activation_53 (Activation)      (None, 7, 7, 192)    0           batch_normalization_53[0][0]     
    __________________________________________________________________________________________________
    activation_58 (Activation)      (None, 7, 7, 192)    0           batch_normalization_58[0][0]     
    __________________________________________________________________________________________________
    activation_59 (Activation)      (None, 7, 7, 192)    0           batch_normalization_59[0][0]     
    __________________________________________________________________________________________________
    mixed6 (Concatenate)            (None, 7, 7, 768)    0           activation_50[0][0]              
                                                                     activation_53[0][0]              
                                                                     activation_58[0][0]              
                                                                     activation_59[0][0]              
    __________________________________________________________________________________________________
    conv2d_64 (Conv2D)              (None, 7, 7, 192)    147456      mixed6[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_64 (BatchNo (None, 7, 7, 192)    576         conv2d_64[0][0]                  
    __________________________________________________________________________________________________
    activation_64 (Activation)      (None, 7, 7, 192)    0           batch_normalization_64[0][0]     
    __________________________________________________________________________________________________
    conv2d_65 (Conv2D)              (None, 7, 7, 192)    258048      activation_64[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_65 (BatchNo (None, 7, 7, 192)    576         conv2d_65[0][0]                  
    __________________________________________________________________________________________________
    activation_65 (Activation)      (None, 7, 7, 192)    0           batch_normalization_65[0][0]     
    __________________________________________________________________________________________________
    conv2d_61 (Conv2D)              (None, 7, 7, 192)    147456      mixed6[0][0]                     
    __________________________________________________________________________________________________
    conv2d_66 (Conv2D)              (None, 7, 7, 192)    258048      activation_65[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_61 (BatchNo (None, 7, 7, 192)    576         conv2d_61[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_66 (BatchNo (None, 7, 7, 192)    576         conv2d_66[0][0]                  
    __________________________________________________________________________________________________
    activation_61 (Activation)      (None, 7, 7, 192)    0           batch_normalization_61[0][0]     
    __________________________________________________________________________________________________
    activation_66 (Activation)      (None, 7, 7, 192)    0           batch_normalization_66[0][0]     
    __________________________________________________________________________________________________
    conv2d_62 (Conv2D)              (None, 7, 7, 192)    258048      activation_61[0][0]              
    __________________________________________________________________________________________________
    conv2d_67 (Conv2D)              (None, 7, 7, 192)    258048      activation_66[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_62 (BatchNo (None, 7, 7, 192)    576         conv2d_62[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_67 (BatchNo (None, 7, 7, 192)    576         conv2d_67[0][0]                  
    __________________________________________________________________________________________________
    activation_62 (Activation)      (None, 7, 7, 192)    0           batch_normalization_62[0][0]     
    __________________________________________________________________________________________________
    activation_67 (Activation)      (None, 7, 7, 192)    0           batch_normalization_67[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_6 (AveragePoo (None, 7, 7, 768)    0           mixed6[0][0]                     
    __________________________________________________________________________________________________
    conv2d_60 (Conv2D)              (None, 7, 7, 192)    147456      mixed6[0][0]                     
    __________________________________________________________________________________________________
    conv2d_63 (Conv2D)              (None, 7, 7, 192)    258048      activation_62[0][0]              
    __________________________________________________________________________________________________
    conv2d_68 (Conv2D)              (None, 7, 7, 192)    258048      activation_67[0][0]              
    __________________________________________________________________________________________________
    conv2d_69 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_6[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_60 (BatchNo (None, 7, 7, 192)    576         conv2d_60[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_63 (BatchNo (None, 7, 7, 192)    576         conv2d_63[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_68 (BatchNo (None, 7, 7, 192)    576         conv2d_68[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_69 (BatchNo (None, 7, 7, 192)    576         conv2d_69[0][0]                  
    __________________________________________________________________________________________________
    activation_60 (Activation)      (None, 7, 7, 192)    0           batch_normalization_60[0][0]     
    __________________________________________________________________________________________________
    activation_63 (Activation)      (None, 7, 7, 192)    0           batch_normalization_63[0][0]     
    __________________________________________________________________________________________________
    activation_68 (Activation)      (None, 7, 7, 192)    0           batch_normalization_68[0][0]     
    __________________________________________________________________________________________________
    activation_69 (Activation)      (None, 7, 7, 192)    0           batch_normalization_69[0][0]     
    __________________________________________________________________________________________________
    mixed7 (Concatenate)            (None, 7, 7, 768)    0           activation_60[0][0]              
                                                                     activation_63[0][0]              
                                                                     activation_68[0][0]              
                                                                     activation_69[0][0]              
    __________________________________________________________________________________________________
    flatten (Flatten)               (None, 37632)        0           mixed7[0][0]                     
    __________________________________________________________________________________________________
    dense (Dense)                   (None, 1024)         38536192    flatten[0][0]                    
    __________________________________________________________________________________________________
    dropout (Dropout)               (None, 1024)         0           dense[0][0]                      
    __________________________________________________________________________________________________
    dense_1 (Dense)                 (None, 1)            1025        dropout[0][0]                    
    ==================================================================================================
    Total params: 47,512,481
    Trainable params: 38,537,217
    Non-trainable params: 8,975,264
    __________________________________________________________________________________________________
    


```python
# Get the Horse or Human dataset
!wget --no-check-certificate https://storage.googleapis.com/laurencemoroney-blog.appspot.com/horse-or-human.zip -O /tmp/horse-or-human.zip

# Get the Horse or Human Validation dataset
!wget --no-check-certificate https://storage.googleapis.com/laurencemoroney-blog.appspot.com/validation-horse-or-human.zip -O /tmp/validation-horse-or-human.zip 
  
from tensorflow.keras.preprocessing.image import ImageDataGenerator

import os
import zipfile

local_zip = '//tmp/horse-or-human.zip'
zip_ref = zipfile.ZipFile(local_zip, 'r')
zip_ref.extractall('/tmp/training')
zip_ref.close()

local_zip = '//tmp/validation-horse-or-human.zip'
zip_ref = zipfile.ZipFile(local_zip, 'r')
zip_ref.extractall('/tmp/validation')
zip_ref.close()
```

    --2020-12-20 10:33:16--  https://storage.googleapis.com/laurencemoroney-blog.appspot.com/horse-or-human.zip
    Resolving storage.googleapis.com (storage.googleapis.com)... 64.233.188.128, 64.233.189.128, 108.177.125.128, ...
    Connecting to storage.googleapis.com (storage.googleapis.com)|64.233.188.128|:443... connected.
    HTTP request sent, awaiting response... 200 OK
    Length: 149574867 (143M) [application/zip]
    Saving to: /tmp/horse-or-human.zip
    
    /tmp/horse-or-human 100%[===================>] 142.65M  92.6MB/s    in 1.5s    
    
    2020-12-20 10:33:17 (92.6 MB/s) - /tmp/horse-or-human.zip saved [149574867/149574867]
    
    --2020-12-20 10:33:17--  https://storage.googleapis.com/laurencemoroney-blog.appspot.com/validation-horse-or-human.zip
    Resolving storage.googleapis.com (storage.googleapis.com)... 64.233.188.128, 64.233.189.128, 108.177.125.128, ...
    Connecting to storage.googleapis.com (storage.googleapis.com)|64.233.188.128|:443... connected.
    HTTP request sent, awaiting response... 200 OK
    Length: 11480187 (11M) [application/zip]
    Saving to: /tmp/validation-horse-or-human.zip
    
    /tmp/validation-hor 100%[===================>]  10.95M  --.-KB/s    in 0.1s    
    
    2020-12-20 10:33:18 (107 MB/s) - /tmp/validation-horse-or-human.zip saved [11480187/11480187]
    
    


```python
# Define our example directories and files
train_dir = '/tmp/training'
validation_dir = '/tmp/validation'

train_horses_dir = os.path.join(train_dir, 'horses') # Directory with our training horse pictures
train_humans_dir = os.path.join(train_dir, 'humans') # Directory with our training humans pictures
validation_horses_dir = os.path.join(validation_dir, 'horses') # Directory with our validation horse pictures
validation_humans_dir = os.path.join(validation_dir, 'humans')# Directory with our validation humanas pictures

train_horses_fnames = os.listdir(train_horses_dir)
train_humans_fnames = os.listdir(train_humans_dir)
validation_horses_fnames = os.listdir(validation_horses_dir)
validation_humans_fnames = os.listdir(validation_humans_dir)

print(len(train_horses_fnames))
print(len(train_humans_fnames))
print(len(validation_horses_fnames))
print(len(validation_humans_fnames))

# Expected Output:
# 500
# 527
# 128
# 128
```

    500
    527
    128
    128
    


```python


# Add our data-augmentation parameters to ImageDataGenerator
train_datagen = ImageDataGenerator(rescale = 1./255.,
                                   rotation_range = 40,
                                   width_shift_range = 0.2,
                                   height_shift_range = 0.2,
                                   shear_range = 0.2,
                                   zoom_range = 0.2,
                                   horizontal_flip = True)

# Note that the validation data should not be augmented!
test_datagen = ImageDataGenerator( rescale = 1.0/255. )

# Flow training images in batches of 20 using train_datagen generator
train_generator = train_datagen.flow_from_directory(train_dir,
                                                    batch_size = 128,
                                                    class_mode = 'binary', 
                                                    target_size = (150, 150))     

# Flow validation images in batches of 20 using test_datagen generator
validation_generator =  test_datagen.flow_from_directory( validation_dir,
                                                          batch_size  = 128,
                                                          class_mode  = 'binary', 
                                                          target_size = (150, 150))

# Expected Output:
# Found 1027 images belonging to 2 classes.
# Found 256 images belonging to 2 classes.
```

    Found 1027 images belonging to 2 classes.
    Found 256 images belonging to 2 classes.
    


```python
# Run this and see how many epochs it should take before the callback
# fires, and stops training at 99.9% accuracy
# (It should take less than 100 epochs)
callbacks = myCallback()
history = model.fit(
            train_generator,
            validation_data = validation_generator,
            epochs = 100,
            verbose = 1,
            callbacks=[callbacks])
```

    Epoch 1/100
    9/9 [==============================] - 20s 1s/step - loss: 0.7363 - accuracy: 0.6752 - val_loss: 0.0219 - val_accuracy: 0.9883
    Epoch 2/100
    9/9 [==============================] - 11s 1s/step - loss: 0.0458 - accuracy: 0.9842 - val_loss: 0.0332 - val_accuracy: 0.9844
    Epoch 3/100
    9/9 [==============================] - 11s 1s/step - loss: 0.0345 - accuracy: 0.9855 - val_loss: 0.0233 - val_accuracy: 0.9883
    Epoch 4/100
    9/9 [==============================] - 11s 1s/step - loss: 0.0201 - accuracy: 0.9912 - val_loss: 0.0367 - val_accuracy: 0.9844
    Epoch 5/100
    9/9 [==============================] - 11s 1s/step - loss: 0.0799 - accuracy: 0.9699 - val_loss: 0.0118 - val_accuracy: 0.9961
    Epoch 6/100
    9/9 [==============================] - 11s 1s/step - loss: 0.0142 - accuracy: 0.9950 - val_loss: 0.0053 - val_accuracy: 0.9961
    Epoch 7/100
    9/9 [==============================] - 11s 1s/step - loss: 0.0059 - accuracy: 0.9989 - val_loss: 0.0109 - val_accuracy: 0.9922
    Epoch 8/100
    9/9 [==============================] - 11s 1s/step - loss: 0.0061 - accuracy: 0.9988 - val_loss: 0.0015 - val_accuracy: 1.0000
    
    Reached 99.9% accuracy so cancelling training!
    

## Results


```python
import matplotlib.pyplot as plt
acc = history.history['accuracy']
val_acc = history.history['val_accuracy']
loss = history.history['loss']
val_loss = history.history['val_loss']

epochs = range(len(acc))

plt.plot(epochs, acc, 'r', label='Training accuracy')
plt.plot(epochs, val_acc, 'b', label='Validation accuracy')
plt.title('Training and validation accuracy')
plt.legend(loc=0)
plt.figure()


plt.show()
```


![png](output_13_0.png)



    <Figure size 432x288 with 0 Axes>



```python
model.summary()

import tempfile

logdir = tempfile.mkdtemp()

_, keras_file = tempfile.mkstemp('.h5')
tf.keras.models.save_model(model, keras_file, include_optimizer=False)
```

    Model: "model"
    __________________________________________________________________________________________________
    Layer (type)                    Output Shape         Param #     Connected to                     
    ==================================================================================================
    input_1 (InputLayer)            [(None, 150, 150, 3) 0                                            
    __________________________________________________________________________________________________
    conv2d (Conv2D)                 (None, 74, 74, 32)   864         input_1[0][0]                    
    __________________________________________________________________________________________________
    batch_normalization (BatchNorma (None, 74, 74, 32)   96          conv2d[0][0]                     
    __________________________________________________________________________________________________
    activation (Activation)         (None, 74, 74, 32)   0           batch_normalization[0][0]        
    __________________________________________________________________________________________________
    conv2d_1 (Conv2D)               (None, 72, 72, 32)   9216        activation[0][0]                 
    __________________________________________________________________________________________________
    batch_normalization_1 (BatchNor (None, 72, 72, 32)   96          conv2d_1[0][0]                   
    __________________________________________________________________________________________________
    activation_1 (Activation)       (None, 72, 72, 32)   0           batch_normalization_1[0][0]      
    __________________________________________________________________________________________________
    conv2d_2 (Conv2D)               (None, 72, 72, 64)   18432       activation_1[0][0]               
    __________________________________________________________________________________________________
    batch_normalization_2 (BatchNor (None, 72, 72, 64)   192         conv2d_2[0][0]                   
    __________________________________________________________________________________________________
    activation_2 (Activation)       (None, 72, 72, 64)   0           batch_normalization_2[0][0]      
    __________________________________________________________________________________________________
    max_pooling2d (MaxPooling2D)    (None, 35, 35, 64)   0           activation_2[0][0]               
    __________________________________________________________________________________________________
    conv2d_3 (Conv2D)               (None, 35, 35, 80)   5120        max_pooling2d[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_3 (BatchNor (None, 35, 35, 80)   240         conv2d_3[0][0]                   
    __________________________________________________________________________________________________
    activation_3 (Activation)       (None, 35, 35, 80)   0           batch_normalization_3[0][0]      
    __________________________________________________________________________________________________
    conv2d_4 (Conv2D)               (None, 33, 33, 192)  138240      activation_3[0][0]               
    __________________________________________________________________________________________________
    batch_normalization_4 (BatchNor (None, 33, 33, 192)  576         conv2d_4[0][0]                   
    __________________________________________________________________________________________________
    activation_4 (Activation)       (None, 33, 33, 192)  0           batch_normalization_4[0][0]      
    __________________________________________________________________________________________________
    max_pooling2d_1 (MaxPooling2D)  (None, 16, 16, 192)  0           activation_4[0][0]               
    __________________________________________________________________________________________________
    conv2d_8 (Conv2D)               (None, 16, 16, 64)   12288       max_pooling2d_1[0][0]            
    __________________________________________________________________________________________________
    batch_normalization_8 (BatchNor (None, 16, 16, 64)   192         conv2d_8[0][0]                   
    __________________________________________________________________________________________________
    activation_8 (Activation)       (None, 16, 16, 64)   0           batch_normalization_8[0][0]      
    __________________________________________________________________________________________________
    conv2d_6 (Conv2D)               (None, 16, 16, 48)   9216        max_pooling2d_1[0][0]            
    __________________________________________________________________________________________________
    conv2d_9 (Conv2D)               (None, 16, 16, 96)   55296       activation_8[0][0]               
    __________________________________________________________________________________________________
    batch_normalization_6 (BatchNor (None, 16, 16, 48)   144         conv2d_6[0][0]                   
    __________________________________________________________________________________________________
    batch_normalization_9 (BatchNor (None, 16, 16, 96)   288         conv2d_9[0][0]                   
    __________________________________________________________________________________________________
    activation_6 (Activation)       (None, 16, 16, 48)   0           batch_normalization_6[0][0]      
    __________________________________________________________________________________________________
    activation_9 (Activation)       (None, 16, 16, 96)   0           batch_normalization_9[0][0]      
    __________________________________________________________________________________________________
    average_pooling2d (AveragePooli (None, 16, 16, 192)  0           max_pooling2d_1[0][0]            
    __________________________________________________________________________________________________
    conv2d_5 (Conv2D)               (None, 16, 16, 64)   12288       max_pooling2d_1[0][0]            
    __________________________________________________________________________________________________
    conv2d_7 (Conv2D)               (None, 16, 16, 64)   76800       activation_6[0][0]               
    __________________________________________________________________________________________________
    conv2d_10 (Conv2D)              (None, 16, 16, 96)   82944       activation_9[0][0]               
    __________________________________________________________________________________________________
    conv2d_11 (Conv2D)              (None, 16, 16, 32)   6144        average_pooling2d[0][0]          
    __________________________________________________________________________________________________
    batch_normalization_5 (BatchNor (None, 16, 16, 64)   192         conv2d_5[0][0]                   
    __________________________________________________________________________________________________
    batch_normalization_7 (BatchNor (None, 16, 16, 64)   192         conv2d_7[0][0]                   
    __________________________________________________________________________________________________
    batch_normalization_10 (BatchNo (None, 16, 16, 96)   288         conv2d_10[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_11 (BatchNo (None, 16, 16, 32)   96          conv2d_11[0][0]                  
    __________________________________________________________________________________________________
    activation_5 (Activation)       (None, 16, 16, 64)   0           batch_normalization_5[0][0]      
    __________________________________________________________________________________________________
    activation_7 (Activation)       (None, 16, 16, 64)   0           batch_normalization_7[0][0]      
    __________________________________________________________________________________________________
    activation_10 (Activation)      (None, 16, 16, 96)   0           batch_normalization_10[0][0]     
    __________________________________________________________________________________________________
    activation_11 (Activation)      (None, 16, 16, 32)   0           batch_normalization_11[0][0]     
    __________________________________________________________________________________________________
    mixed0 (Concatenate)            (None, 16, 16, 256)  0           activation_5[0][0]               
                                                                     activation_7[0][0]               
                                                                     activation_10[0][0]              
                                                                     activation_11[0][0]              
    __________________________________________________________________________________________________
    conv2d_15 (Conv2D)              (None, 16, 16, 64)   16384       mixed0[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_15 (BatchNo (None, 16, 16, 64)   192         conv2d_15[0][0]                  
    __________________________________________________________________________________________________
    activation_15 (Activation)      (None, 16, 16, 64)   0           batch_normalization_15[0][0]     
    __________________________________________________________________________________________________
    conv2d_13 (Conv2D)              (None, 16, 16, 48)   12288       mixed0[0][0]                     
    __________________________________________________________________________________________________
    conv2d_16 (Conv2D)              (None, 16, 16, 96)   55296       activation_15[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_13 (BatchNo (None, 16, 16, 48)   144         conv2d_13[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_16 (BatchNo (None, 16, 16, 96)   288         conv2d_16[0][0]                  
    __________________________________________________________________________________________________
    activation_13 (Activation)      (None, 16, 16, 48)   0           batch_normalization_13[0][0]     
    __________________________________________________________________________________________________
    activation_16 (Activation)      (None, 16, 16, 96)   0           batch_normalization_16[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_1 (AveragePoo (None, 16, 16, 256)  0           mixed0[0][0]                     
    __________________________________________________________________________________________________
    conv2d_12 (Conv2D)              (None, 16, 16, 64)   16384       mixed0[0][0]                     
    __________________________________________________________________________________________________
    conv2d_14 (Conv2D)              (None, 16, 16, 64)   76800       activation_13[0][0]              
    __________________________________________________________________________________________________
    conv2d_17 (Conv2D)              (None, 16, 16, 96)   82944       activation_16[0][0]              
    __________________________________________________________________________________________________
    conv2d_18 (Conv2D)              (None, 16, 16, 64)   16384       average_pooling2d_1[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_12 (BatchNo (None, 16, 16, 64)   192         conv2d_12[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_14 (BatchNo (None, 16, 16, 64)   192         conv2d_14[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_17 (BatchNo (None, 16, 16, 96)   288         conv2d_17[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_18 (BatchNo (None, 16, 16, 64)   192         conv2d_18[0][0]                  
    __________________________________________________________________________________________________
    activation_12 (Activation)      (None, 16, 16, 64)   0           batch_normalization_12[0][0]     
    __________________________________________________________________________________________________
    activation_14 (Activation)      (None, 16, 16, 64)   0           batch_normalization_14[0][0]     
    __________________________________________________________________________________________________
    activation_17 (Activation)      (None, 16, 16, 96)   0           batch_normalization_17[0][0]     
    __________________________________________________________________________________________________
    activation_18 (Activation)      (None, 16, 16, 64)   0           batch_normalization_18[0][0]     
    __________________________________________________________________________________________________
    mixed1 (Concatenate)            (None, 16, 16, 288)  0           activation_12[0][0]              
                                                                     activation_14[0][0]              
                                                                     activation_17[0][0]              
                                                                     activation_18[0][0]              
    __________________________________________________________________________________________________
    conv2d_22 (Conv2D)              (None, 16, 16, 64)   18432       mixed1[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_22 (BatchNo (None, 16, 16, 64)   192         conv2d_22[0][0]                  
    __________________________________________________________________________________________________
    activation_22 (Activation)      (None, 16, 16, 64)   0           batch_normalization_22[0][0]     
    __________________________________________________________________________________________________
    conv2d_20 (Conv2D)              (None, 16, 16, 48)   13824       mixed1[0][0]                     
    __________________________________________________________________________________________________
    conv2d_23 (Conv2D)              (None, 16, 16, 96)   55296       activation_22[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_20 (BatchNo (None, 16, 16, 48)   144         conv2d_20[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_23 (BatchNo (None, 16, 16, 96)   288         conv2d_23[0][0]                  
    __________________________________________________________________________________________________
    activation_20 (Activation)      (None, 16, 16, 48)   0           batch_normalization_20[0][0]     
    __________________________________________________________________________________________________
    activation_23 (Activation)      (None, 16, 16, 96)   0           batch_normalization_23[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_2 (AveragePoo (None, 16, 16, 288)  0           mixed1[0][0]                     
    __________________________________________________________________________________________________
    conv2d_19 (Conv2D)              (None, 16, 16, 64)   18432       mixed1[0][0]                     
    __________________________________________________________________________________________________
    conv2d_21 (Conv2D)              (None, 16, 16, 64)   76800       activation_20[0][0]              
    __________________________________________________________________________________________________
    conv2d_24 (Conv2D)              (None, 16, 16, 96)   82944       activation_23[0][0]              
    __________________________________________________________________________________________________
    conv2d_25 (Conv2D)              (None, 16, 16, 64)   18432       average_pooling2d_2[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_19 (BatchNo (None, 16, 16, 64)   192         conv2d_19[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_21 (BatchNo (None, 16, 16, 64)   192         conv2d_21[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_24 (BatchNo (None, 16, 16, 96)   288         conv2d_24[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_25 (BatchNo (None, 16, 16, 64)   192         conv2d_25[0][0]                  
    __________________________________________________________________________________________________
    activation_19 (Activation)      (None, 16, 16, 64)   0           batch_normalization_19[0][0]     
    __________________________________________________________________________________________________
    activation_21 (Activation)      (None, 16, 16, 64)   0           batch_normalization_21[0][0]     
    __________________________________________________________________________________________________
    activation_24 (Activation)      (None, 16, 16, 96)   0           batch_normalization_24[0][0]     
    __________________________________________________________________________________________________
    activation_25 (Activation)      (None, 16, 16, 64)   0           batch_normalization_25[0][0]     
    __________________________________________________________________________________________________
    mixed2 (Concatenate)            (None, 16, 16, 288)  0           activation_19[0][0]              
                                                                     activation_21[0][0]              
                                                                     activation_24[0][0]              
                                                                     activation_25[0][0]              
    __________________________________________________________________________________________________
    conv2d_27 (Conv2D)              (None, 16, 16, 64)   18432       mixed2[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_27 (BatchNo (None, 16, 16, 64)   192         conv2d_27[0][0]                  
    __________________________________________________________________________________________________
    activation_27 (Activation)      (None, 16, 16, 64)   0           batch_normalization_27[0][0]     
    __________________________________________________________________________________________________
    conv2d_28 (Conv2D)              (None, 16, 16, 96)   55296       activation_27[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_28 (BatchNo (None, 16, 16, 96)   288         conv2d_28[0][0]                  
    __________________________________________________________________________________________________
    activation_28 (Activation)      (None, 16, 16, 96)   0           batch_normalization_28[0][0]     
    __________________________________________________________________________________________________
    conv2d_26 (Conv2D)              (None, 7, 7, 384)    995328      mixed2[0][0]                     
    __________________________________________________________________________________________________
    conv2d_29 (Conv2D)              (None, 7, 7, 96)     82944       activation_28[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_26 (BatchNo (None, 7, 7, 384)    1152        conv2d_26[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_29 (BatchNo (None, 7, 7, 96)     288         conv2d_29[0][0]                  
    __________________________________________________________________________________________________
    activation_26 (Activation)      (None, 7, 7, 384)    0           batch_normalization_26[0][0]     
    __________________________________________________________________________________________________
    activation_29 (Activation)      (None, 7, 7, 96)     0           batch_normalization_29[0][0]     
    __________________________________________________________________________________________________
    max_pooling2d_2 (MaxPooling2D)  (None, 7, 7, 288)    0           mixed2[0][0]                     
    __________________________________________________________________________________________________
    mixed3 (Concatenate)            (None, 7, 7, 768)    0           activation_26[0][0]              
                                                                     activation_29[0][0]              
                                                                     max_pooling2d_2[0][0]            
    __________________________________________________________________________________________________
    conv2d_34 (Conv2D)              (None, 7, 7, 128)    98304       mixed3[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_34 (BatchNo (None, 7, 7, 128)    384         conv2d_34[0][0]                  
    __________________________________________________________________________________________________
    activation_34 (Activation)      (None, 7, 7, 128)    0           batch_normalization_34[0][0]     
    __________________________________________________________________________________________________
    conv2d_35 (Conv2D)              (None, 7, 7, 128)    114688      activation_34[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_35 (BatchNo (None, 7, 7, 128)    384         conv2d_35[0][0]                  
    __________________________________________________________________________________________________
    activation_35 (Activation)      (None, 7, 7, 128)    0           batch_normalization_35[0][0]     
    __________________________________________________________________________________________________
    conv2d_31 (Conv2D)              (None, 7, 7, 128)    98304       mixed3[0][0]                     
    __________________________________________________________________________________________________
    conv2d_36 (Conv2D)              (None, 7, 7, 128)    114688      activation_35[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_31 (BatchNo (None, 7, 7, 128)    384         conv2d_31[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_36 (BatchNo (None, 7, 7, 128)    384         conv2d_36[0][0]                  
    __________________________________________________________________________________________________
    activation_31 (Activation)      (None, 7, 7, 128)    0           batch_normalization_31[0][0]     
    __________________________________________________________________________________________________
    activation_36 (Activation)      (None, 7, 7, 128)    0           batch_normalization_36[0][0]     
    __________________________________________________________________________________________________
    conv2d_32 (Conv2D)              (None, 7, 7, 128)    114688      activation_31[0][0]              
    __________________________________________________________________________________________________
    conv2d_37 (Conv2D)              (None, 7, 7, 128)    114688      activation_36[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_32 (BatchNo (None, 7, 7, 128)    384         conv2d_32[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_37 (BatchNo (None, 7, 7, 128)    384         conv2d_37[0][0]                  
    __________________________________________________________________________________________________
    activation_32 (Activation)      (None, 7, 7, 128)    0           batch_normalization_32[0][0]     
    __________________________________________________________________________________________________
    activation_37 (Activation)      (None, 7, 7, 128)    0           batch_normalization_37[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_3 (AveragePoo (None, 7, 7, 768)    0           mixed3[0][0]                     
    __________________________________________________________________________________________________
    conv2d_30 (Conv2D)              (None, 7, 7, 192)    147456      mixed3[0][0]                     
    __________________________________________________________________________________________________
    conv2d_33 (Conv2D)              (None, 7, 7, 192)    172032      activation_32[0][0]              
    __________________________________________________________________________________________________
    conv2d_38 (Conv2D)              (None, 7, 7, 192)    172032      activation_37[0][0]              
    __________________________________________________________________________________________________
    conv2d_39 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_3[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_30 (BatchNo (None, 7, 7, 192)    576         conv2d_30[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_33 (BatchNo (None, 7, 7, 192)    576         conv2d_33[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_38 (BatchNo (None, 7, 7, 192)    576         conv2d_38[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_39 (BatchNo (None, 7, 7, 192)    576         conv2d_39[0][0]                  
    __________________________________________________________________________________________________
    activation_30 (Activation)      (None, 7, 7, 192)    0           batch_normalization_30[0][0]     
    __________________________________________________________________________________________________
    activation_33 (Activation)      (None, 7, 7, 192)    0           batch_normalization_33[0][0]     
    __________________________________________________________________________________________________
    activation_38 (Activation)      (None, 7, 7, 192)    0           batch_normalization_38[0][0]     
    __________________________________________________________________________________________________
    activation_39 (Activation)      (None, 7, 7, 192)    0           batch_normalization_39[0][0]     
    __________________________________________________________________________________________________
    mixed4 (Concatenate)            (None, 7, 7, 768)    0           activation_30[0][0]              
                                                                     activation_33[0][0]              
                                                                     activation_38[0][0]              
                                                                     activation_39[0][0]              
    __________________________________________________________________________________________________
    conv2d_44 (Conv2D)              (None, 7, 7, 160)    122880      mixed4[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_44 (BatchNo (None, 7, 7, 160)    480         conv2d_44[0][0]                  
    __________________________________________________________________________________________________
    activation_44 (Activation)      (None, 7, 7, 160)    0           batch_normalization_44[0][0]     
    __________________________________________________________________________________________________
    conv2d_45 (Conv2D)              (None, 7, 7, 160)    179200      activation_44[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_45 (BatchNo (None, 7, 7, 160)    480         conv2d_45[0][0]                  
    __________________________________________________________________________________________________
    activation_45 (Activation)      (None, 7, 7, 160)    0           batch_normalization_45[0][0]     
    __________________________________________________________________________________________________
    conv2d_41 (Conv2D)              (None, 7, 7, 160)    122880      mixed4[0][0]                     
    __________________________________________________________________________________________________
    conv2d_46 (Conv2D)              (None, 7, 7, 160)    179200      activation_45[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_41 (BatchNo (None, 7, 7, 160)    480         conv2d_41[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_46 (BatchNo (None, 7, 7, 160)    480         conv2d_46[0][0]                  
    __________________________________________________________________________________________________
    activation_41 (Activation)      (None, 7, 7, 160)    0           batch_normalization_41[0][0]     
    __________________________________________________________________________________________________
    activation_46 (Activation)      (None, 7, 7, 160)    0           batch_normalization_46[0][0]     
    __________________________________________________________________________________________________
    conv2d_42 (Conv2D)              (None, 7, 7, 160)    179200      activation_41[0][0]              
    __________________________________________________________________________________________________
    conv2d_47 (Conv2D)              (None, 7, 7, 160)    179200      activation_46[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_42 (BatchNo (None, 7, 7, 160)    480         conv2d_42[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_47 (BatchNo (None, 7, 7, 160)    480         conv2d_47[0][0]                  
    __________________________________________________________________________________________________
    activation_42 (Activation)      (None, 7, 7, 160)    0           batch_normalization_42[0][0]     
    __________________________________________________________________________________________________
    activation_47 (Activation)      (None, 7, 7, 160)    0           batch_normalization_47[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_4 (AveragePoo (None, 7, 7, 768)    0           mixed4[0][0]                     
    __________________________________________________________________________________________________
    conv2d_40 (Conv2D)              (None, 7, 7, 192)    147456      mixed4[0][0]                     
    __________________________________________________________________________________________________
    conv2d_43 (Conv2D)              (None, 7, 7, 192)    215040      activation_42[0][0]              
    __________________________________________________________________________________________________
    conv2d_48 (Conv2D)              (None, 7, 7, 192)    215040      activation_47[0][0]              
    __________________________________________________________________________________________________
    conv2d_49 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_4[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_40 (BatchNo (None, 7, 7, 192)    576         conv2d_40[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_43 (BatchNo (None, 7, 7, 192)    576         conv2d_43[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_48 (BatchNo (None, 7, 7, 192)    576         conv2d_48[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_49 (BatchNo (None, 7, 7, 192)    576         conv2d_49[0][0]                  
    __________________________________________________________________________________________________
    activation_40 (Activation)      (None, 7, 7, 192)    0           batch_normalization_40[0][0]     
    __________________________________________________________________________________________________
    activation_43 (Activation)      (None, 7, 7, 192)    0           batch_normalization_43[0][0]     
    __________________________________________________________________________________________________
    activation_48 (Activation)      (None, 7, 7, 192)    0           batch_normalization_48[0][0]     
    __________________________________________________________________________________________________
    activation_49 (Activation)      (None, 7, 7, 192)    0           batch_normalization_49[0][0]     
    __________________________________________________________________________________________________
    mixed5 (Concatenate)            (None, 7, 7, 768)    0           activation_40[0][0]              
                                                                     activation_43[0][0]              
                                                                     activation_48[0][0]              
                                                                     activation_49[0][0]              
    __________________________________________________________________________________________________
    conv2d_54 (Conv2D)              (None, 7, 7, 160)    122880      mixed5[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_54 (BatchNo (None, 7, 7, 160)    480         conv2d_54[0][0]                  
    __________________________________________________________________________________________________
    activation_54 (Activation)      (None, 7, 7, 160)    0           batch_normalization_54[0][0]     
    __________________________________________________________________________________________________
    conv2d_55 (Conv2D)              (None, 7, 7, 160)    179200      activation_54[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_55 (BatchNo (None, 7, 7, 160)    480         conv2d_55[0][0]                  
    __________________________________________________________________________________________________
    activation_55 (Activation)      (None, 7, 7, 160)    0           batch_normalization_55[0][0]     
    __________________________________________________________________________________________________
    conv2d_51 (Conv2D)              (None, 7, 7, 160)    122880      mixed5[0][0]                     
    __________________________________________________________________________________________________
    conv2d_56 (Conv2D)              (None, 7, 7, 160)    179200      activation_55[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_51 (BatchNo (None, 7, 7, 160)    480         conv2d_51[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_56 (BatchNo (None, 7, 7, 160)    480         conv2d_56[0][0]                  
    __________________________________________________________________________________________________
    activation_51 (Activation)      (None, 7, 7, 160)    0           batch_normalization_51[0][0]     
    __________________________________________________________________________________________________
    activation_56 (Activation)      (None, 7, 7, 160)    0           batch_normalization_56[0][0]     
    __________________________________________________________________________________________________
    conv2d_52 (Conv2D)              (None, 7, 7, 160)    179200      activation_51[0][0]              
    __________________________________________________________________________________________________
    conv2d_57 (Conv2D)              (None, 7, 7, 160)    179200      activation_56[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_52 (BatchNo (None, 7, 7, 160)    480         conv2d_52[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_57 (BatchNo (None, 7, 7, 160)    480         conv2d_57[0][0]                  
    __________________________________________________________________________________________________
    activation_52 (Activation)      (None, 7, 7, 160)    0           batch_normalization_52[0][0]     
    __________________________________________________________________________________________________
    activation_57 (Activation)      (None, 7, 7, 160)    0           batch_normalization_57[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_5 (AveragePoo (None, 7, 7, 768)    0           mixed5[0][0]                     
    __________________________________________________________________________________________________
    conv2d_50 (Conv2D)              (None, 7, 7, 192)    147456      mixed5[0][0]                     
    __________________________________________________________________________________________________
    conv2d_53 (Conv2D)              (None, 7, 7, 192)    215040      activation_52[0][0]              
    __________________________________________________________________________________________________
    conv2d_58 (Conv2D)              (None, 7, 7, 192)    215040      activation_57[0][0]              
    __________________________________________________________________________________________________
    conv2d_59 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_5[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_50 (BatchNo (None, 7, 7, 192)    576         conv2d_50[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_53 (BatchNo (None, 7, 7, 192)    576         conv2d_53[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_58 (BatchNo (None, 7, 7, 192)    576         conv2d_58[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_59 (BatchNo (None, 7, 7, 192)    576         conv2d_59[0][0]                  
    __________________________________________________________________________________________________
    activation_50 (Activation)      (None, 7, 7, 192)    0           batch_normalization_50[0][0]     
    __________________________________________________________________________________________________
    activation_53 (Activation)      (None, 7, 7, 192)    0           batch_normalization_53[0][0]     
    __________________________________________________________________________________________________
    activation_58 (Activation)      (None, 7, 7, 192)    0           batch_normalization_58[0][0]     
    __________________________________________________________________________________________________
    activation_59 (Activation)      (None, 7, 7, 192)    0           batch_normalization_59[0][0]     
    __________________________________________________________________________________________________
    mixed6 (Concatenate)            (None, 7, 7, 768)    0           activation_50[0][0]              
                                                                     activation_53[0][0]              
                                                                     activation_58[0][0]              
                                                                     activation_59[0][0]              
    __________________________________________________________________________________________________
    conv2d_64 (Conv2D)              (None, 7, 7, 192)    147456      mixed6[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_64 (BatchNo (None, 7, 7, 192)    576         conv2d_64[0][0]                  
    __________________________________________________________________________________________________
    activation_64 (Activation)      (None, 7, 7, 192)    0           batch_normalization_64[0][0]     
    __________________________________________________________________________________________________
    conv2d_65 (Conv2D)              (None, 7, 7, 192)    258048      activation_64[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_65 (BatchNo (None, 7, 7, 192)    576         conv2d_65[0][0]                  
    __________________________________________________________________________________________________
    activation_65 (Activation)      (None, 7, 7, 192)    0           batch_normalization_65[0][0]     
    __________________________________________________________________________________________________
    conv2d_61 (Conv2D)              (None, 7, 7, 192)    147456      mixed6[0][0]                     
    __________________________________________________________________________________________________
    conv2d_66 (Conv2D)              (None, 7, 7, 192)    258048      activation_65[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_61 (BatchNo (None, 7, 7, 192)    576         conv2d_61[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_66 (BatchNo (None, 7, 7, 192)    576         conv2d_66[0][0]                  
    __________________________________________________________________________________________________
    activation_61 (Activation)      (None, 7, 7, 192)    0           batch_normalization_61[0][0]     
    __________________________________________________________________________________________________
    activation_66 (Activation)      (None, 7, 7, 192)    0           batch_normalization_66[0][0]     
    __________________________________________________________________________________________________
    conv2d_62 (Conv2D)              (None, 7, 7, 192)    258048      activation_61[0][0]              
    __________________________________________________________________________________________________
    conv2d_67 (Conv2D)              (None, 7, 7, 192)    258048      activation_66[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_62 (BatchNo (None, 7, 7, 192)    576         conv2d_62[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_67 (BatchNo (None, 7, 7, 192)    576         conv2d_67[0][0]                  
    __________________________________________________________________________________________________
    activation_62 (Activation)      (None, 7, 7, 192)    0           batch_normalization_62[0][0]     
    __________________________________________________________________________________________________
    activation_67 (Activation)      (None, 7, 7, 192)    0           batch_normalization_67[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_6 (AveragePoo (None, 7, 7, 768)    0           mixed6[0][0]                     
    __________________________________________________________________________________________________
    conv2d_60 (Conv2D)              (None, 7, 7, 192)    147456      mixed6[0][0]                     
    __________________________________________________________________________________________________
    conv2d_63 (Conv2D)              (None, 7, 7, 192)    258048      activation_62[0][0]              
    __________________________________________________________________________________________________
    conv2d_68 (Conv2D)              (None, 7, 7, 192)    258048      activation_67[0][0]              
    __________________________________________________________________________________________________
    conv2d_69 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_6[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_60 (BatchNo (None, 7, 7, 192)    576         conv2d_60[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_63 (BatchNo (None, 7, 7, 192)    576         conv2d_63[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_68 (BatchNo (None, 7, 7, 192)    576         conv2d_68[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_69 (BatchNo (None, 7, 7, 192)    576         conv2d_69[0][0]                  
    __________________________________________________________________________________________________
    activation_60 (Activation)      (None, 7, 7, 192)    0           batch_normalization_60[0][0]     
    __________________________________________________________________________________________________
    activation_63 (Activation)      (None, 7, 7, 192)    0           batch_normalization_63[0][0]     
    __________________________________________________________________________________________________
    activation_68 (Activation)      (None, 7, 7, 192)    0           batch_normalization_68[0][0]     
    __________________________________________________________________________________________________
    activation_69 (Activation)      (None, 7, 7, 192)    0           batch_normalization_69[0][0]     
    __________________________________________________________________________________________________
    mixed7 (Concatenate)            (None, 7, 7, 768)    0           activation_60[0][0]              
                                                                     activation_63[0][0]              
                                                                     activation_68[0][0]              
                                                                     activation_69[0][0]              
    __________________________________________________________________________________________________
    flatten (Flatten)               (None, 37632)        0           mixed7[0][0]                     
    __________________________________________________________________________________________________
    dense (Dense)                   (None, 1024)         38536192    flatten[0][0]                    
    __________________________________________________________________________________________________
    dropout (Dropout)               (None, 1024)         0           dense[0][0]                      
    __________________________________________________________________________________________________
    dense_1 (Dense)                 (None, 1)            1025        dropout[0][0]                    
    ==================================================================================================
    Total params: 47,512,481
    Trainable params: 38,537,217
    Non-trainable params: 8,975,264
    __________________________________________________________________________________________________
    

# Compression algorithms that are already available in tensor and checking their performance


```python
!pip install tensorflow_model_optimization
```

    Collecting tensorflow_model_optimization
    [?25l  Downloading https://files.pythonhosted.org/packages/55/38/4fd48ea1bfcb0b6e36d949025200426fe9c3a8bfae029f0973d85518fa5a/tensorflow_model_optimization-0.5.0-py2.py3-none-any.whl (172kB)
    [K     || 174kB 4.2MB/s 
    [?25hRequirement already satisfied: numpy~=1.14 in /usr/local/lib/python3.6/dist-packages (from tensorflow_model_optimization) (1.19.4)
    Requirement already satisfied: six~=1.10 in /usr/local/lib/python3.6/dist-packages (from tensorflow_model_optimization) (1.15.0)
    Requirement already satisfied: dm-tree~=0.1.1 in /usr/local/lib/python3.6/dist-packages (from tensorflow_model_optimization) (0.1.5)
    Installing collected packages: tensorflow-model-optimization
    Successfully installed tensorflow-model-optimization-0.5.0
    


```python
import tensorflow_model_optimization as tfmot


pruning_schedule = tfmot.sparsity.keras.PolynomialDecay(
                        initial_sparsity=0.5, final_sparsity=0.9,
                        begin_step=0, end_step=9, frequency = 1)

model_for_pruning = tfmot.sparsity.keras.prune_low_magnitude(model, pruning_schedule=pruning_schedule)

model_for_pruning.compile(optimizer = RMSprop(lr=0.0001), 
              loss = 'binary_crossentropy', 
              metrics = ['accuracy'])

# Requirement for the model_for_pruning

import tempfile

logdir = tempfile.mkdtemp()

callbacks = [
  tfmot.sparsity.keras.UpdatePruningStep(),
  tfmot.sparsity.keras.PruningSummaries(log_dir=logdir),
]

model_for_pruning.fit(train_generator,
            validation_data = validation_generator,
            epochs = 10,
            verbose = 1,
            callbacks=[callbacks])
```

    /usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/engine/base_layer.py:2281: UserWarning: `layer.add_variable` is deprecated and will be removed in a future version. Please use `layer.add_weight` method instead.
      warnings.warn('`layer.add_variable` is deprecated and '
    

    Epoch 1/10
    9/9 [==============================] - 59s 2s/step - loss: 2.6591 - accuracy: 0.6514 - val_loss: 0.8027 - val_accuracy: 0.5000
    Epoch 2/10
    9/9 [==============================] - 13s 1s/step - loss: 0.7281 - accuracy: 0.4864 - val_loss: 0.7118 - val_accuracy: 0.5000
    Epoch 3/10
    9/9 [==============================] - 12s 1s/step - loss: 0.7160 - accuracy: 0.5079 - val_loss: 0.7323 - val_accuracy: 0.5000
    Epoch 4/10
    9/9 [==============================] - 12s 1s/step - loss: 0.7513 - accuracy: 0.5317 - val_loss: 0.6874 - val_accuracy: 0.5078
    Epoch 5/10
    9/9 [==============================] - 12s 1s/step - loss: 0.7169 - accuracy: 0.4972 - val_loss: 0.6915 - val_accuracy: 0.5000
    Epoch 6/10
    9/9 [==============================] - 12s 1s/step - loss: 0.7129 - accuracy: 0.5295 - val_loss: 0.6902 - val_accuracy: 0.5000
    Epoch 7/10
    9/9 [==============================] - 12s 1s/step - loss: 0.7108 - accuracy: 0.5299 - val_loss: 0.6901 - val_accuracy: 0.5000
    Epoch 8/10
    9/9 [==============================] - 12s 1s/step - loss: 0.7145 - accuracy: 0.5219 - val_loss: 0.6893 - val_accuracy: 0.5000
    Epoch 9/10
    9/9 [==============================] - 12s 1s/step - loss: 0.7033 - accuracy: 0.5237 - val_loss: 0.6854 - val_accuracy: 0.5000
    Epoch 10/10
    9/9 [==============================] - 12s 1s/step - loss: 0.7037 - accuracy: 0.5198 - val_loss: 0.6919 - val_accuracy: 0.5000
    




    <tensorflow.python.keras.callbacks.History at 0x7fb84dbe8668>




```python
import matplotlib.pyplot as plt
acc = history.history['accuracy']
val_acc = history.history['val_accuracy']
loss = history.history['loss']
val_loss = history.history['val_loss']

epochs = range(len(acc))

plt.plot(epochs, acc, 'r', label='Training accuracy')
plt.plot(epochs, val_acc, 'b', label='Validation accuracy')
plt.title('Training and validation accuracy')
plt.legend(loc=0)
plt.figure()


plt.show()
```


![png](output_18_0.png)



    <Figure size 432x288 with 0 Axes>



```python
model_for_pruning.summary()

```

    Model: "model"
    __________________________________________________________________________________________________
    Layer (type)                    Output Shape         Param #     Connected to                     
    ==================================================================================================
    input_1 (InputLayer)            [(None, 150, 150, 3) 0                                            
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d (Pru (None, 74, 74, 32)   1730        input_1[0][0]                    
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 74, 74, 32)   97          prune_low_magnitude_conv2d[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_activation  (None, 74, 74, 32)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_1 (P (None, 72, 72, 32)   18434       prune_low_magnitude_activation[0]
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 72, 72, 32)   97          prune_low_magnitude_conv2d_1[0][0
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 72, 72, 32)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_2 (P (None, 72, 72, 64)   36866       prune_low_magnitude_activation_1[
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 72, 72, 64)   193         prune_low_magnitude_conv2d_2[0][0
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 72, 72, 64)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_max_pooling (None, 35, 35, 64)   1           prune_low_magnitude_activation_2[
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_3 (P (None, 35, 35, 80)   10242       prune_low_magnitude_max_pooling2d
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 35, 35, 80)   241         prune_low_magnitude_conv2d_3[0][0
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 35, 35, 80)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_4 (P (None, 33, 33, 192)  276482      prune_low_magnitude_activation_3[
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 33, 33, 192)  577         prune_low_magnitude_conv2d_4[0][0
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 33, 33, 192)  1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_max_pooling (None, 16, 16, 192)  1           prune_low_magnitude_activation_4[
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_8 (P (None, 16, 16, 64)   24578       prune_low_magnitude_max_pooling2d
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 64)   193         prune_low_magnitude_conv2d_8[0][0
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 64)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_6 (P (None, 16, 16, 48)   18434       prune_low_magnitude_max_pooling2d
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_9 (P (None, 16, 16, 96)   110594      prune_low_magnitude_activation_8[
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 48)   145         prune_low_magnitude_conv2d_6[0][0
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 96)   289         prune_low_magnitude_conv2d_9[0][0
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 48)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 96)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_average_poo (None, 16, 16, 192)  1           prune_low_magnitude_max_pooling2d
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_5 (P (None, 16, 16, 64)   24578       prune_low_magnitude_max_pooling2d
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_7 (P (None, 16, 16, 64)   153602      prune_low_magnitude_activation_6[
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_10 ( (None, 16, 16, 96)   165890      prune_low_magnitude_activation_9[
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_11 ( (None, 16, 16, 32)   12290       prune_low_magnitude_average_pooli
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 64)   193         prune_low_magnitude_conv2d_5[0][0
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 64)   193         prune_low_magnitude_conv2d_7[0][0
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 96)   289         prune_low_magnitude_conv2d_10[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 32)   97          prune_low_magnitude_conv2d_11[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 64)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 64)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 96)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 32)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_mixed0 (Pru (None, 16, 16, 256)  1           prune_low_magnitude_activation_5[
                                                                     prune_low_magnitude_activation_7[
                                                                     prune_low_magnitude_activation_10
                                                                     prune_low_magnitude_activation_11
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_15 ( (None, 16, 16, 64)   32770       prune_low_magnitude_mixed0[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 64)   193         prune_low_magnitude_conv2d_15[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 64)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_13 ( (None, 16, 16, 48)   24578       prune_low_magnitude_mixed0[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_16 ( (None, 16, 16, 96)   110594      prune_low_magnitude_activation_15
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 48)   145         prune_low_magnitude_conv2d_13[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 96)   289         prune_low_magnitude_conv2d_16[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 48)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 96)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_average_poo (None, 16, 16, 256)  1           prune_low_magnitude_mixed0[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_12 ( (None, 16, 16, 64)   32770       prune_low_magnitude_mixed0[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_14 ( (None, 16, 16, 64)   153602      prune_low_magnitude_activation_13
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_17 ( (None, 16, 16, 96)   165890      prune_low_magnitude_activation_16
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_18 ( (None, 16, 16, 64)   32770       prune_low_magnitude_average_pooli
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 64)   193         prune_low_magnitude_conv2d_12[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 64)   193         prune_low_magnitude_conv2d_14[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 96)   289         prune_low_magnitude_conv2d_17[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 64)   193         prune_low_magnitude_conv2d_18[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 64)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 64)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 96)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 64)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_mixed1 (Pru (None, 16, 16, 288)  1           prune_low_magnitude_activation_12
                                                                     prune_low_magnitude_activation_14
                                                                     prune_low_magnitude_activation_17
                                                                     prune_low_magnitude_activation_18
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_22 ( (None, 16, 16, 64)   36866       prune_low_magnitude_mixed1[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 64)   193         prune_low_magnitude_conv2d_22[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 64)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_20 ( (None, 16, 16, 48)   27650       prune_low_magnitude_mixed1[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_23 ( (None, 16, 16, 96)   110594      prune_low_magnitude_activation_22
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 48)   145         prune_low_magnitude_conv2d_20[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 96)   289         prune_low_magnitude_conv2d_23[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 48)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 96)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_average_poo (None, 16, 16, 288)  1           prune_low_magnitude_mixed1[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_19 ( (None, 16, 16, 64)   36866       prune_low_magnitude_mixed1[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_21 ( (None, 16, 16, 64)   153602      prune_low_magnitude_activation_20
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_24 ( (None, 16, 16, 96)   165890      prune_low_magnitude_activation_23
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_25 ( (None, 16, 16, 64)   36866       prune_low_magnitude_average_pooli
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 64)   193         prune_low_magnitude_conv2d_19[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 64)   193         prune_low_magnitude_conv2d_21[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 96)   289         prune_low_magnitude_conv2d_24[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 64)   193         prune_low_magnitude_conv2d_25[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 64)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 64)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 96)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 64)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_mixed2 (Pru (None, 16, 16, 288)  1           prune_low_magnitude_activation_19
                                                                     prune_low_magnitude_activation_21
                                                                     prune_low_magnitude_activation_24
                                                                     prune_low_magnitude_activation_25
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_27 ( (None, 16, 16, 64)   36866       prune_low_magnitude_mixed2[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 64)   193         prune_low_magnitude_conv2d_27[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 64)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_28 ( (None, 16, 16, 96)   110594      prune_low_magnitude_activation_27
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 16, 16, 96)   289         prune_low_magnitude_conv2d_28[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 16, 16, 96)   1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_26 ( (None, 7, 7, 384)    1990658     prune_low_magnitude_mixed2[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_29 ( (None, 7, 7, 96)     165890      prune_low_magnitude_activation_28
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 384)    1153        prune_low_magnitude_conv2d_26[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 96)     289         prune_low_magnitude_conv2d_29[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 384)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 96)     1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_max_pooling (None, 7, 7, 288)    1           prune_low_magnitude_mixed2[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_mixed3 (Pru (None, 7, 7, 768)    1           prune_low_magnitude_activation_26
                                                                     prune_low_magnitude_activation_29
                                                                     prune_low_magnitude_max_pooling2d
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_34 ( (None, 7, 7, 128)    196610      prune_low_magnitude_mixed3[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 128)    385         prune_low_magnitude_conv2d_34[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 128)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_35 ( (None, 7, 7, 128)    229378      prune_low_magnitude_activation_34
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 128)    385         prune_low_magnitude_conv2d_35[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 128)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_31 ( (None, 7, 7, 128)    196610      prune_low_magnitude_mixed3[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_36 ( (None, 7, 7, 128)    229378      prune_low_magnitude_activation_35
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 128)    385         prune_low_magnitude_conv2d_31[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 128)    385         prune_low_magnitude_conv2d_36[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 128)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 128)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_32 ( (None, 7, 7, 128)    229378      prune_low_magnitude_activation_31
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_37 ( (None, 7, 7, 128)    229378      prune_low_magnitude_activation_36
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 128)    385         prune_low_magnitude_conv2d_32[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 128)    385         prune_low_magnitude_conv2d_37[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 128)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 128)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_average_poo (None, 7, 7, 768)    1           prune_low_magnitude_mixed3[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_30 ( (None, 7, 7, 192)    294914      prune_low_magnitude_mixed3[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_33 ( (None, 7, 7, 192)    344066      prune_low_magnitude_activation_32
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_38 ( (None, 7, 7, 192)    344066      prune_low_magnitude_activation_37
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_39 ( (None, 7, 7, 192)    294914      prune_low_magnitude_average_pooli
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_30[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_33[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_38[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_39[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_mixed4 (Pru (None, 7, 7, 768)    1           prune_low_magnitude_activation_30
                                                                     prune_low_magnitude_activation_33
                                                                     prune_low_magnitude_activation_38
                                                                     prune_low_magnitude_activation_39
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_44 ( (None, 7, 7, 160)    245762      prune_low_magnitude_mixed4[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 160)    481         prune_low_magnitude_conv2d_44[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 160)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_45 ( (None, 7, 7, 160)    358402      prune_low_magnitude_activation_44
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 160)    481         prune_low_magnitude_conv2d_45[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 160)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_41 ( (None, 7, 7, 160)    245762      prune_low_magnitude_mixed4[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_46 ( (None, 7, 7, 160)    358402      prune_low_magnitude_activation_45
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 160)    481         prune_low_magnitude_conv2d_41[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 160)    481         prune_low_magnitude_conv2d_46[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 160)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 160)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_42 ( (None, 7, 7, 160)    358402      prune_low_magnitude_activation_41
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_47 ( (None, 7, 7, 160)    358402      prune_low_magnitude_activation_46
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 160)    481         prune_low_magnitude_conv2d_42[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 160)    481         prune_low_magnitude_conv2d_47[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 160)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 160)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_average_poo (None, 7, 7, 768)    1           prune_low_magnitude_mixed4[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_40 ( (None, 7, 7, 192)    294914      prune_low_magnitude_mixed4[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_43 ( (None, 7, 7, 192)    430082      prune_low_magnitude_activation_42
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_48 ( (None, 7, 7, 192)    430082      prune_low_magnitude_activation_47
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_49 ( (None, 7, 7, 192)    294914      prune_low_magnitude_average_pooli
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_40[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_43[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_48[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_49[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_mixed5 (Pru (None, 7, 7, 768)    1           prune_low_magnitude_activation_40
                                                                     prune_low_magnitude_activation_43
                                                                     prune_low_magnitude_activation_48
                                                                     prune_low_magnitude_activation_49
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_54 ( (None, 7, 7, 160)    245762      prune_low_magnitude_mixed5[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 160)    481         prune_low_magnitude_conv2d_54[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 160)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_55 ( (None, 7, 7, 160)    358402      prune_low_magnitude_activation_54
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 160)    481         prune_low_magnitude_conv2d_55[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 160)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_51 ( (None, 7, 7, 160)    245762      prune_low_magnitude_mixed5[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_56 ( (None, 7, 7, 160)    358402      prune_low_magnitude_activation_55
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 160)    481         prune_low_magnitude_conv2d_51[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 160)    481         prune_low_magnitude_conv2d_56[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 160)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 160)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_52 ( (None, 7, 7, 160)    358402      prune_low_magnitude_activation_51
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_57 ( (None, 7, 7, 160)    358402      prune_low_magnitude_activation_56
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 160)    481         prune_low_magnitude_conv2d_52[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 160)    481         prune_low_magnitude_conv2d_57[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 160)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 160)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_average_poo (None, 7, 7, 768)    1           prune_low_magnitude_mixed5[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_50 ( (None, 7, 7, 192)    294914      prune_low_magnitude_mixed5[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_53 ( (None, 7, 7, 192)    430082      prune_low_magnitude_activation_52
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_58 ( (None, 7, 7, 192)    430082      prune_low_magnitude_activation_57
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_59 ( (None, 7, 7, 192)    294914      prune_low_magnitude_average_pooli
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_50[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_53[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_58[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_59[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_mixed6 (Pru (None, 7, 7, 768)    1           prune_low_magnitude_activation_50
                                                                     prune_low_magnitude_activation_53
                                                                     prune_low_magnitude_activation_58
                                                                     prune_low_magnitude_activation_59
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_64 ( (None, 7, 7, 192)    294914      prune_low_magnitude_mixed6[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_64[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_65 ( (None, 7, 7, 192)    516098      prune_low_magnitude_activation_64
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_65[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_61 ( (None, 7, 7, 192)    294914      prune_low_magnitude_mixed6[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_66 ( (None, 7, 7, 192)    516098      prune_low_magnitude_activation_65
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_61[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_66[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_62 ( (None, 7, 7, 192)    516098      prune_low_magnitude_activation_61
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_67 ( (None, 7, 7, 192)    516098      prune_low_magnitude_activation_66
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_62[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_67[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_average_poo (None, 7, 7, 768)    1           prune_low_magnitude_mixed6[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_60 ( (None, 7, 7, 192)    294914      prune_low_magnitude_mixed6[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_63 ( (None, 7, 7, 192)    516098      prune_low_magnitude_activation_62
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_68 ( (None, 7, 7, 192)    516098      prune_low_magnitude_activation_67
    __________________________________________________________________________________________________
    prune_low_magnitude_conv2d_69 ( (None, 7, 7, 192)    294914      prune_low_magnitude_average_pooli
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_60[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_63[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_68[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_batch_norma (None, 7, 7, 192)    577         prune_low_magnitude_conv2d_69[0][
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_activation_ (None, 7, 7, 192)    1           prune_low_magnitude_batch_normali
    __________________________________________________________________________________________________
    prune_low_magnitude_mixed7 (Pru (None, 7, 7, 768)    1           prune_low_magnitude_activation_60
                                                                     prune_low_magnitude_activation_63
                                                                     prune_low_magnitude_activation_68
                                                                     prune_low_magnitude_activation_69
    __________________________________________________________________________________________________
    prune_low_magnitude_flatten (Pr (None, 37632)        1           prune_low_magnitude_mixed7[0][0] 
    __________________________________________________________________________________________________
    prune_low_magnitude_dense (Prun (None, 1024)         77071362    prune_low_magnitude_flatten[0][0]
    __________________________________________________________________________________________________
    prune_low_magnitude_dropout (Pr (None, 1024)         1           prune_low_magnitude_dense[0][0]  
    __________________________________________________________________________________________________
    prune_low_magnitude_dense_1 (Pr (None, 1)            2051        prune_low_magnitude_dropout[0][0]
    ==================================================================================================
    Total params: 94,996,017
    Trainable params: 38,537,217
    Non-trainable params: 56,458,800
    __________________________________________________________________________________________________
    


```python
model.summary()
```

    Model: "model"
    __________________________________________________________________________________________________
    Layer (type)                    Output Shape         Param #     Connected to                     
    ==================================================================================================
    input_1 (InputLayer)            [(None, 150, 150, 3) 0                                            
    __________________________________________________________________________________________________
    conv2d (Conv2D)                 (None, 74, 74, 32)   864         input_1[0][0]                    
    __________________________________________________________________________________________________
    batch_normalization (BatchNorma (None, 74, 74, 32)   96          conv2d[0][0]                     
    __________________________________________________________________________________________________
    activation (Activation)         (None, 74, 74, 32)   0           batch_normalization[0][0]        
    __________________________________________________________________________________________________
    conv2d_1 (Conv2D)               (None, 72, 72, 32)   9216        activation[0][0]                 
    __________________________________________________________________________________________________
    batch_normalization_1 (BatchNor (None, 72, 72, 32)   96          conv2d_1[0][0]                   
    __________________________________________________________________________________________________
    activation_1 (Activation)       (None, 72, 72, 32)   0           batch_normalization_1[0][0]      
    __________________________________________________________________________________________________
    conv2d_2 (Conv2D)               (None, 72, 72, 64)   18432       activation_1[0][0]               
    __________________________________________________________________________________________________
    batch_normalization_2 (BatchNor (None, 72, 72, 64)   192         conv2d_2[0][0]                   
    __________________________________________________________________________________________________
    activation_2 (Activation)       (None, 72, 72, 64)   0           batch_normalization_2[0][0]      
    __________________________________________________________________________________________________
    max_pooling2d (MaxPooling2D)    (None, 35, 35, 64)   0           activation_2[0][0]               
    __________________________________________________________________________________________________
    conv2d_3 (Conv2D)               (None, 35, 35, 80)   5120        max_pooling2d[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_3 (BatchNor (None, 35, 35, 80)   240         conv2d_3[0][0]                   
    __________________________________________________________________________________________________
    activation_3 (Activation)       (None, 35, 35, 80)   0           batch_normalization_3[0][0]      
    __________________________________________________________________________________________________
    conv2d_4 (Conv2D)               (None, 33, 33, 192)  138240      activation_3[0][0]               
    __________________________________________________________________________________________________
    batch_normalization_4 (BatchNor (None, 33, 33, 192)  576         conv2d_4[0][0]                   
    __________________________________________________________________________________________________
    activation_4 (Activation)       (None, 33, 33, 192)  0           batch_normalization_4[0][0]      
    __________________________________________________________________________________________________
    max_pooling2d_1 (MaxPooling2D)  (None, 16, 16, 192)  0           activation_4[0][0]               
    __________________________________________________________________________________________________
    conv2d_8 (Conv2D)               (None, 16, 16, 64)   12288       max_pooling2d_1[0][0]            
    __________________________________________________________________________________________________
    batch_normalization_8 (BatchNor (None, 16, 16, 64)   192         conv2d_8[0][0]                   
    __________________________________________________________________________________________________
    activation_8 (Activation)       (None, 16, 16, 64)   0           batch_normalization_8[0][0]      
    __________________________________________________________________________________________________
    conv2d_6 (Conv2D)               (None, 16, 16, 48)   9216        max_pooling2d_1[0][0]            
    __________________________________________________________________________________________________
    conv2d_9 (Conv2D)               (None, 16, 16, 96)   55296       activation_8[0][0]               
    __________________________________________________________________________________________________
    batch_normalization_6 (BatchNor (None, 16, 16, 48)   144         conv2d_6[0][0]                   
    __________________________________________________________________________________________________
    batch_normalization_9 (BatchNor (None, 16, 16, 96)   288         conv2d_9[0][0]                   
    __________________________________________________________________________________________________
    activation_6 (Activation)       (None, 16, 16, 48)   0           batch_normalization_6[0][0]      
    __________________________________________________________________________________________________
    activation_9 (Activation)       (None, 16, 16, 96)   0           batch_normalization_9[0][0]      
    __________________________________________________________________________________________________
    average_pooling2d (AveragePooli (None, 16, 16, 192)  0           max_pooling2d_1[0][0]            
    __________________________________________________________________________________________________
    conv2d_5 (Conv2D)               (None, 16, 16, 64)   12288       max_pooling2d_1[0][0]            
    __________________________________________________________________________________________________
    conv2d_7 (Conv2D)               (None, 16, 16, 64)   76800       activation_6[0][0]               
    __________________________________________________________________________________________________
    conv2d_10 (Conv2D)              (None, 16, 16, 96)   82944       activation_9[0][0]               
    __________________________________________________________________________________________________
    conv2d_11 (Conv2D)              (None, 16, 16, 32)   6144        average_pooling2d[0][0]          
    __________________________________________________________________________________________________
    batch_normalization_5 (BatchNor (None, 16, 16, 64)   192         conv2d_5[0][0]                   
    __________________________________________________________________________________________________
    batch_normalization_7 (BatchNor (None, 16, 16, 64)   192         conv2d_7[0][0]                   
    __________________________________________________________________________________________________
    batch_normalization_10 (BatchNo (None, 16, 16, 96)   288         conv2d_10[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_11 (BatchNo (None, 16, 16, 32)   96          conv2d_11[0][0]                  
    __________________________________________________________________________________________________
    activation_5 (Activation)       (None, 16, 16, 64)   0           batch_normalization_5[0][0]      
    __________________________________________________________________________________________________
    activation_7 (Activation)       (None, 16, 16, 64)   0           batch_normalization_7[0][0]      
    __________________________________________________________________________________________________
    activation_10 (Activation)      (None, 16, 16, 96)   0           batch_normalization_10[0][0]     
    __________________________________________________________________________________________________
    activation_11 (Activation)      (None, 16, 16, 32)   0           batch_normalization_11[0][0]     
    __________________________________________________________________________________________________
    mixed0 (Concatenate)            (None, 16, 16, 256)  0           activation_5[0][0]               
                                                                     activation_7[0][0]               
                                                                     activation_10[0][0]              
                                                                     activation_11[0][0]              
    __________________________________________________________________________________________________
    conv2d_15 (Conv2D)              (None, 16, 16, 64)   16384       mixed0[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_15 (BatchNo (None, 16, 16, 64)   192         conv2d_15[0][0]                  
    __________________________________________________________________________________________________
    activation_15 (Activation)      (None, 16, 16, 64)   0           batch_normalization_15[0][0]     
    __________________________________________________________________________________________________
    conv2d_13 (Conv2D)              (None, 16, 16, 48)   12288       mixed0[0][0]                     
    __________________________________________________________________________________________________
    conv2d_16 (Conv2D)              (None, 16, 16, 96)   55296       activation_15[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_13 (BatchNo (None, 16, 16, 48)   144         conv2d_13[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_16 (BatchNo (None, 16, 16, 96)   288         conv2d_16[0][0]                  
    __________________________________________________________________________________________________
    activation_13 (Activation)      (None, 16, 16, 48)   0           batch_normalization_13[0][0]     
    __________________________________________________________________________________________________
    activation_16 (Activation)      (None, 16, 16, 96)   0           batch_normalization_16[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_1 (AveragePoo (None, 16, 16, 256)  0           mixed0[0][0]                     
    __________________________________________________________________________________________________
    conv2d_12 (Conv2D)              (None, 16, 16, 64)   16384       mixed0[0][0]                     
    __________________________________________________________________________________________________
    conv2d_14 (Conv2D)              (None, 16, 16, 64)   76800       activation_13[0][0]              
    __________________________________________________________________________________________________
    conv2d_17 (Conv2D)              (None, 16, 16, 96)   82944       activation_16[0][0]              
    __________________________________________________________________________________________________
    conv2d_18 (Conv2D)              (None, 16, 16, 64)   16384       average_pooling2d_1[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_12 (BatchNo (None, 16, 16, 64)   192         conv2d_12[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_14 (BatchNo (None, 16, 16, 64)   192         conv2d_14[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_17 (BatchNo (None, 16, 16, 96)   288         conv2d_17[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_18 (BatchNo (None, 16, 16, 64)   192         conv2d_18[0][0]                  
    __________________________________________________________________________________________________
    activation_12 (Activation)      (None, 16, 16, 64)   0           batch_normalization_12[0][0]     
    __________________________________________________________________________________________________
    activation_14 (Activation)      (None, 16, 16, 64)   0           batch_normalization_14[0][0]     
    __________________________________________________________________________________________________
    activation_17 (Activation)      (None, 16, 16, 96)   0           batch_normalization_17[0][0]     
    __________________________________________________________________________________________________
    activation_18 (Activation)      (None, 16, 16, 64)   0           batch_normalization_18[0][0]     
    __________________________________________________________________________________________________
    mixed1 (Concatenate)            (None, 16, 16, 288)  0           activation_12[0][0]              
                                                                     activation_14[0][0]              
                                                                     activation_17[0][0]              
                                                                     activation_18[0][0]              
    __________________________________________________________________________________________________
    conv2d_22 (Conv2D)              (None, 16, 16, 64)   18432       mixed1[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_22 (BatchNo (None, 16, 16, 64)   192         conv2d_22[0][0]                  
    __________________________________________________________________________________________________
    activation_22 (Activation)      (None, 16, 16, 64)   0           batch_normalization_22[0][0]     
    __________________________________________________________________________________________________
    conv2d_20 (Conv2D)              (None, 16, 16, 48)   13824       mixed1[0][0]                     
    __________________________________________________________________________________________________
    conv2d_23 (Conv2D)              (None, 16, 16, 96)   55296       activation_22[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_20 (BatchNo (None, 16, 16, 48)   144         conv2d_20[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_23 (BatchNo (None, 16, 16, 96)   288         conv2d_23[0][0]                  
    __________________________________________________________________________________________________
    activation_20 (Activation)      (None, 16, 16, 48)   0           batch_normalization_20[0][0]     
    __________________________________________________________________________________________________
    activation_23 (Activation)      (None, 16, 16, 96)   0           batch_normalization_23[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_2 (AveragePoo (None, 16, 16, 288)  0           mixed1[0][0]                     
    __________________________________________________________________________________________________
    conv2d_19 (Conv2D)              (None, 16, 16, 64)   18432       mixed1[0][0]                     
    __________________________________________________________________________________________________
    conv2d_21 (Conv2D)              (None, 16, 16, 64)   76800       activation_20[0][0]              
    __________________________________________________________________________________________________
    conv2d_24 (Conv2D)              (None, 16, 16, 96)   82944       activation_23[0][0]              
    __________________________________________________________________________________________________
    conv2d_25 (Conv2D)              (None, 16, 16, 64)   18432       average_pooling2d_2[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_19 (BatchNo (None, 16, 16, 64)   192         conv2d_19[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_21 (BatchNo (None, 16, 16, 64)   192         conv2d_21[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_24 (BatchNo (None, 16, 16, 96)   288         conv2d_24[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_25 (BatchNo (None, 16, 16, 64)   192         conv2d_25[0][0]                  
    __________________________________________________________________________________________________
    activation_19 (Activation)      (None, 16, 16, 64)   0           batch_normalization_19[0][0]     
    __________________________________________________________________________________________________
    activation_21 (Activation)      (None, 16, 16, 64)   0           batch_normalization_21[0][0]     
    __________________________________________________________________________________________________
    activation_24 (Activation)      (None, 16, 16, 96)   0           batch_normalization_24[0][0]     
    __________________________________________________________________________________________________
    activation_25 (Activation)      (None, 16, 16, 64)   0           batch_normalization_25[0][0]     
    __________________________________________________________________________________________________
    mixed2 (Concatenate)            (None, 16, 16, 288)  0           activation_19[0][0]              
                                                                     activation_21[0][0]              
                                                                     activation_24[0][0]              
                                                                     activation_25[0][0]              
    __________________________________________________________________________________________________
    conv2d_27 (Conv2D)              (None, 16, 16, 64)   18432       mixed2[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_27 (BatchNo (None, 16, 16, 64)   192         conv2d_27[0][0]                  
    __________________________________________________________________________________________________
    activation_27 (Activation)      (None, 16, 16, 64)   0           batch_normalization_27[0][0]     
    __________________________________________________________________________________________________
    conv2d_28 (Conv2D)              (None, 16, 16, 96)   55296       activation_27[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_28 (BatchNo (None, 16, 16, 96)   288         conv2d_28[0][0]                  
    __________________________________________________________________________________________________
    activation_28 (Activation)      (None, 16, 16, 96)   0           batch_normalization_28[0][0]     
    __________________________________________________________________________________________________
    conv2d_26 (Conv2D)              (None, 7, 7, 384)    995328      mixed2[0][0]                     
    __________________________________________________________________________________________________
    conv2d_29 (Conv2D)              (None, 7, 7, 96)     82944       activation_28[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_26 (BatchNo (None, 7, 7, 384)    1152        conv2d_26[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_29 (BatchNo (None, 7, 7, 96)     288         conv2d_29[0][0]                  
    __________________________________________________________________________________________________
    activation_26 (Activation)      (None, 7, 7, 384)    0           batch_normalization_26[0][0]     
    __________________________________________________________________________________________________
    activation_29 (Activation)      (None, 7, 7, 96)     0           batch_normalization_29[0][0]     
    __________________________________________________________________________________________________
    max_pooling2d_2 (MaxPooling2D)  (None, 7, 7, 288)    0           mixed2[0][0]                     
    __________________________________________________________________________________________________
    mixed3 (Concatenate)            (None, 7, 7, 768)    0           activation_26[0][0]              
                                                                     activation_29[0][0]              
                                                                     max_pooling2d_2[0][0]            
    __________________________________________________________________________________________________
    conv2d_34 (Conv2D)              (None, 7, 7, 128)    98304       mixed3[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_34 (BatchNo (None, 7, 7, 128)    384         conv2d_34[0][0]                  
    __________________________________________________________________________________________________
    activation_34 (Activation)      (None, 7, 7, 128)    0           batch_normalization_34[0][0]     
    __________________________________________________________________________________________________
    conv2d_35 (Conv2D)              (None, 7, 7, 128)    114688      activation_34[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_35 (BatchNo (None, 7, 7, 128)    384         conv2d_35[0][0]                  
    __________________________________________________________________________________________________
    activation_35 (Activation)      (None, 7, 7, 128)    0           batch_normalization_35[0][0]     
    __________________________________________________________________________________________________
    conv2d_31 (Conv2D)              (None, 7, 7, 128)    98304       mixed3[0][0]                     
    __________________________________________________________________________________________________
    conv2d_36 (Conv2D)              (None, 7, 7, 128)    114688      activation_35[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_31 (BatchNo (None, 7, 7, 128)    384         conv2d_31[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_36 (BatchNo (None, 7, 7, 128)    384         conv2d_36[0][0]                  
    __________________________________________________________________________________________________
    activation_31 (Activation)      (None, 7, 7, 128)    0           batch_normalization_31[0][0]     
    __________________________________________________________________________________________________
    activation_36 (Activation)      (None, 7, 7, 128)    0           batch_normalization_36[0][0]     
    __________________________________________________________________________________________________
    conv2d_32 (Conv2D)              (None, 7, 7, 128)    114688      activation_31[0][0]              
    __________________________________________________________________________________________________
    conv2d_37 (Conv2D)              (None, 7, 7, 128)    114688      activation_36[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_32 (BatchNo (None, 7, 7, 128)    384         conv2d_32[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_37 (BatchNo (None, 7, 7, 128)    384         conv2d_37[0][0]                  
    __________________________________________________________________________________________________
    activation_32 (Activation)      (None, 7, 7, 128)    0           batch_normalization_32[0][0]     
    __________________________________________________________________________________________________
    activation_37 (Activation)      (None, 7, 7, 128)    0           batch_normalization_37[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_3 (AveragePoo (None, 7, 7, 768)    0           mixed3[0][0]                     
    __________________________________________________________________________________________________
    conv2d_30 (Conv2D)              (None, 7, 7, 192)    147456      mixed3[0][0]                     
    __________________________________________________________________________________________________
    conv2d_33 (Conv2D)              (None, 7, 7, 192)    172032      activation_32[0][0]              
    __________________________________________________________________________________________________
    conv2d_38 (Conv2D)              (None, 7, 7, 192)    172032      activation_37[0][0]              
    __________________________________________________________________________________________________
    conv2d_39 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_3[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_30 (BatchNo (None, 7, 7, 192)    576         conv2d_30[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_33 (BatchNo (None, 7, 7, 192)    576         conv2d_33[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_38 (BatchNo (None, 7, 7, 192)    576         conv2d_38[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_39 (BatchNo (None, 7, 7, 192)    576         conv2d_39[0][0]                  
    __________________________________________________________________________________________________
    activation_30 (Activation)      (None, 7, 7, 192)    0           batch_normalization_30[0][0]     
    __________________________________________________________________________________________________
    activation_33 (Activation)      (None, 7, 7, 192)    0           batch_normalization_33[0][0]     
    __________________________________________________________________________________________________
    activation_38 (Activation)      (None, 7, 7, 192)    0           batch_normalization_38[0][0]     
    __________________________________________________________________________________________________
    activation_39 (Activation)      (None, 7, 7, 192)    0           batch_normalization_39[0][0]     
    __________________________________________________________________________________________________
    mixed4 (Concatenate)            (None, 7, 7, 768)    0           activation_30[0][0]              
                                                                     activation_33[0][0]              
                                                                     activation_38[0][0]              
                                                                     activation_39[0][0]              
    __________________________________________________________________________________________________
    conv2d_44 (Conv2D)              (None, 7, 7, 160)    122880      mixed4[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_44 (BatchNo (None, 7, 7, 160)    480         conv2d_44[0][0]                  
    __________________________________________________________________________________________________
    activation_44 (Activation)      (None, 7, 7, 160)    0           batch_normalization_44[0][0]     
    __________________________________________________________________________________________________
    conv2d_45 (Conv2D)              (None, 7, 7, 160)    179200      activation_44[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_45 (BatchNo (None, 7, 7, 160)    480         conv2d_45[0][0]                  
    __________________________________________________________________________________________________
    activation_45 (Activation)      (None, 7, 7, 160)    0           batch_normalization_45[0][0]     
    __________________________________________________________________________________________________
    conv2d_41 (Conv2D)              (None, 7, 7, 160)    122880      mixed4[0][0]                     
    __________________________________________________________________________________________________
    conv2d_46 (Conv2D)              (None, 7, 7, 160)    179200      activation_45[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_41 (BatchNo (None, 7, 7, 160)    480         conv2d_41[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_46 (BatchNo (None, 7, 7, 160)    480         conv2d_46[0][0]                  
    __________________________________________________________________________________________________
    activation_41 (Activation)      (None, 7, 7, 160)    0           batch_normalization_41[0][0]     
    __________________________________________________________________________________________________
    activation_46 (Activation)      (None, 7, 7, 160)    0           batch_normalization_46[0][0]     
    __________________________________________________________________________________________________
    conv2d_42 (Conv2D)              (None, 7, 7, 160)    179200      activation_41[0][0]              
    __________________________________________________________________________________________________
    conv2d_47 (Conv2D)              (None, 7, 7, 160)    179200      activation_46[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_42 (BatchNo (None, 7, 7, 160)    480         conv2d_42[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_47 (BatchNo (None, 7, 7, 160)    480         conv2d_47[0][0]                  
    __________________________________________________________________________________________________
    activation_42 (Activation)      (None, 7, 7, 160)    0           batch_normalization_42[0][0]     
    __________________________________________________________________________________________________
    activation_47 (Activation)      (None, 7, 7, 160)    0           batch_normalization_47[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_4 (AveragePoo (None, 7, 7, 768)    0           mixed4[0][0]                     
    __________________________________________________________________________________________________
    conv2d_40 (Conv2D)              (None, 7, 7, 192)    147456      mixed4[0][0]                     
    __________________________________________________________________________________________________
    conv2d_43 (Conv2D)              (None, 7, 7, 192)    215040      activation_42[0][0]              
    __________________________________________________________________________________________________
    conv2d_48 (Conv2D)              (None, 7, 7, 192)    215040      activation_47[0][0]              
    __________________________________________________________________________________________________
    conv2d_49 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_4[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_40 (BatchNo (None, 7, 7, 192)    576         conv2d_40[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_43 (BatchNo (None, 7, 7, 192)    576         conv2d_43[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_48 (BatchNo (None, 7, 7, 192)    576         conv2d_48[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_49 (BatchNo (None, 7, 7, 192)    576         conv2d_49[0][0]                  
    __________________________________________________________________________________________________
    activation_40 (Activation)      (None, 7, 7, 192)    0           batch_normalization_40[0][0]     
    __________________________________________________________________________________________________
    activation_43 (Activation)      (None, 7, 7, 192)    0           batch_normalization_43[0][0]     
    __________________________________________________________________________________________________
    activation_48 (Activation)      (None, 7, 7, 192)    0           batch_normalization_48[0][0]     
    __________________________________________________________________________________________________
    activation_49 (Activation)      (None, 7, 7, 192)    0           batch_normalization_49[0][0]     
    __________________________________________________________________________________________________
    mixed5 (Concatenate)            (None, 7, 7, 768)    0           activation_40[0][0]              
                                                                     activation_43[0][0]              
                                                                     activation_48[0][0]              
                                                                     activation_49[0][0]              
    __________________________________________________________________________________________________
    conv2d_54 (Conv2D)              (None, 7, 7, 160)    122880      mixed5[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_54 (BatchNo (None, 7, 7, 160)    480         conv2d_54[0][0]                  
    __________________________________________________________________________________________________
    activation_54 (Activation)      (None, 7, 7, 160)    0           batch_normalization_54[0][0]     
    __________________________________________________________________________________________________
    conv2d_55 (Conv2D)              (None, 7, 7, 160)    179200      activation_54[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_55 (BatchNo (None, 7, 7, 160)    480         conv2d_55[0][0]                  
    __________________________________________________________________________________________________
    activation_55 (Activation)      (None, 7, 7, 160)    0           batch_normalization_55[0][0]     
    __________________________________________________________________________________________________
    conv2d_51 (Conv2D)              (None, 7, 7, 160)    122880      mixed5[0][0]                     
    __________________________________________________________________________________________________
    conv2d_56 (Conv2D)              (None, 7, 7, 160)    179200      activation_55[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_51 (BatchNo (None, 7, 7, 160)    480         conv2d_51[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_56 (BatchNo (None, 7, 7, 160)    480         conv2d_56[0][0]                  
    __________________________________________________________________________________________________
    activation_51 (Activation)      (None, 7, 7, 160)    0           batch_normalization_51[0][0]     
    __________________________________________________________________________________________________
    activation_56 (Activation)      (None, 7, 7, 160)    0           batch_normalization_56[0][0]     
    __________________________________________________________________________________________________
    conv2d_52 (Conv2D)              (None, 7, 7, 160)    179200      activation_51[0][0]              
    __________________________________________________________________________________________________
    conv2d_57 (Conv2D)              (None, 7, 7, 160)    179200      activation_56[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_52 (BatchNo (None, 7, 7, 160)    480         conv2d_52[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_57 (BatchNo (None, 7, 7, 160)    480         conv2d_57[0][0]                  
    __________________________________________________________________________________________________
    activation_52 (Activation)      (None, 7, 7, 160)    0           batch_normalization_52[0][0]     
    __________________________________________________________________________________________________
    activation_57 (Activation)      (None, 7, 7, 160)    0           batch_normalization_57[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_5 (AveragePoo (None, 7, 7, 768)    0           mixed5[0][0]                     
    __________________________________________________________________________________________________
    conv2d_50 (Conv2D)              (None, 7, 7, 192)    147456      mixed5[0][0]                     
    __________________________________________________________________________________________________
    conv2d_53 (Conv2D)              (None, 7, 7, 192)    215040      activation_52[0][0]              
    __________________________________________________________________________________________________
    conv2d_58 (Conv2D)              (None, 7, 7, 192)    215040      activation_57[0][0]              
    __________________________________________________________________________________________________
    conv2d_59 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_5[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_50 (BatchNo (None, 7, 7, 192)    576         conv2d_50[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_53 (BatchNo (None, 7, 7, 192)    576         conv2d_53[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_58 (BatchNo (None, 7, 7, 192)    576         conv2d_58[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_59 (BatchNo (None, 7, 7, 192)    576         conv2d_59[0][0]                  
    __________________________________________________________________________________________________
    activation_50 (Activation)      (None, 7, 7, 192)    0           batch_normalization_50[0][0]     
    __________________________________________________________________________________________________
    activation_53 (Activation)      (None, 7, 7, 192)    0           batch_normalization_53[0][0]     
    __________________________________________________________________________________________________
    activation_58 (Activation)      (None, 7, 7, 192)    0           batch_normalization_58[0][0]     
    __________________________________________________________________________________________________
    activation_59 (Activation)      (None, 7, 7, 192)    0           batch_normalization_59[0][0]     
    __________________________________________________________________________________________________
    mixed6 (Concatenate)            (None, 7, 7, 768)    0           activation_50[0][0]              
                                                                     activation_53[0][0]              
                                                                     activation_58[0][0]              
                                                                     activation_59[0][0]              
    __________________________________________________________________________________________________
    conv2d_64 (Conv2D)              (None, 7, 7, 192)    147456      mixed6[0][0]                     
    __________________________________________________________________________________________________
    batch_normalization_64 (BatchNo (None, 7, 7, 192)    576         conv2d_64[0][0]                  
    __________________________________________________________________________________________________
    activation_64 (Activation)      (None, 7, 7, 192)    0           batch_normalization_64[0][0]     
    __________________________________________________________________________________________________
    conv2d_65 (Conv2D)              (None, 7, 7, 192)    258048      activation_64[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_65 (BatchNo (None, 7, 7, 192)    576         conv2d_65[0][0]                  
    __________________________________________________________________________________________________
    activation_65 (Activation)      (None, 7, 7, 192)    0           batch_normalization_65[0][0]     
    __________________________________________________________________________________________________
    conv2d_61 (Conv2D)              (None, 7, 7, 192)    147456      mixed6[0][0]                     
    __________________________________________________________________________________________________
    conv2d_66 (Conv2D)              (None, 7, 7, 192)    258048      activation_65[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_61 (BatchNo (None, 7, 7, 192)    576         conv2d_61[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_66 (BatchNo (None, 7, 7, 192)    576         conv2d_66[0][0]                  
    __________________________________________________________________________________________________
    activation_61 (Activation)      (None, 7, 7, 192)    0           batch_normalization_61[0][0]     
    __________________________________________________________________________________________________
    activation_66 (Activation)      (None, 7, 7, 192)    0           batch_normalization_66[0][0]     
    __________________________________________________________________________________________________
    conv2d_62 (Conv2D)              (None, 7, 7, 192)    258048      activation_61[0][0]              
    __________________________________________________________________________________________________
    conv2d_67 (Conv2D)              (None, 7, 7, 192)    258048      activation_66[0][0]              
    __________________________________________________________________________________________________
    batch_normalization_62 (BatchNo (None, 7, 7, 192)    576         conv2d_62[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_67 (BatchNo (None, 7, 7, 192)    576         conv2d_67[0][0]                  
    __________________________________________________________________________________________________
    activation_62 (Activation)      (None, 7, 7, 192)    0           batch_normalization_62[0][0]     
    __________________________________________________________________________________________________
    activation_67 (Activation)      (None, 7, 7, 192)    0           batch_normalization_67[0][0]     
    __________________________________________________________________________________________________
    average_pooling2d_6 (AveragePoo (None, 7, 7, 768)    0           mixed6[0][0]                     
    __________________________________________________________________________________________________
    conv2d_60 (Conv2D)              (None, 7, 7, 192)    147456      mixed6[0][0]                     
    __________________________________________________________________________________________________
    conv2d_63 (Conv2D)              (None, 7, 7, 192)    258048      activation_62[0][0]              
    __________________________________________________________________________________________________
    conv2d_68 (Conv2D)              (None, 7, 7, 192)    258048      activation_67[0][0]              
    __________________________________________________________________________________________________
    conv2d_69 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_6[0][0]        
    __________________________________________________________________________________________________
    batch_normalization_60 (BatchNo (None, 7, 7, 192)    576         conv2d_60[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_63 (BatchNo (None, 7, 7, 192)    576         conv2d_63[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_68 (BatchNo (None, 7, 7, 192)    576         conv2d_68[0][0]                  
    __________________________________________________________________________________________________
    batch_normalization_69 (BatchNo (None, 7, 7, 192)    576         conv2d_69[0][0]                  
    __________________________________________________________________________________________________
    activation_60 (Activation)      (None, 7, 7, 192)    0           batch_normalization_60[0][0]     
    __________________________________________________________________________________________________
    activation_63 (Activation)      (None, 7, 7, 192)    0           batch_normalization_63[0][0]     
    __________________________________________________________________________________________________
    activation_68 (Activation)      (None, 7, 7, 192)    0           batch_normalization_68[0][0]     
    __________________________________________________________________________________________________
    activation_69 (Activation)      (None, 7, 7, 192)    0           batch_normalization_69[0][0]     
    __________________________________________________________________________________________________
    mixed7 (Concatenate)            (None, 7, 7, 768)    0           activation_60[0][0]              
                                                                     activation_63[0][0]              
                                                                     activation_68[0][0]              
                                                                     activation_69[0][0]              
    __________________________________________________________________________________________________
    flatten (Flatten)               (None, 37632)        0           mixed7[0][0]                     
    __________________________________________________________________________________________________
    dense (Dense)                   (None, 1024)         38536192    flatten[0][0]                    
    __________________________________________________________________________________________________
    dropout (Dropout)               (None, 1024)         0           dense[0][0]                      
    __________________________________________________________________________________________________
    dense_1 (Dense)                 (None, 1)            1025        dropout[0][0]                    
    ==================================================================================================
    Total params: 47,512,481
    Trainable params: 38,537,217
    Non-trainable params: 8,975,264
    __________________________________________________________________________________________________
    


```python

model_for_export = tfmot.sparsity.keras.strip_pruning(model_for_pruning)

model_for_export.summary()
```

    Model: "model"
    __________________________________________________________________________________________________
    Layer (type)                    Output Shape         Param #     Connected to                     
    ==================================================================================================
    input_1 (InputLayer)            [(None, 150, 150, 3) 0                                            
    __________________________________________________________________________________________________
    conv2d (Conv2D)                 (None, 74, 74, 32)   864         input_1[0][0]                    
    __________________________________________________________________________________________________
    batch_normalization (BatchNorma (None, 74, 74, 32)   96          conv2d[2][0]                     
    __________________________________________________________________________________________________
    activation (Activation)         (None, 74, 74, 32)   0           batch_normalization[2][0]        
    __________________________________________________________________________________________________
    conv2d_1 (Conv2D)               (None, 72, 72, 32)   9216        activation[2][0]                 
    __________________________________________________________________________________________________
    batch_normalization_1 (BatchNor (None, 72, 72, 32)   96          conv2d_1[2][0]                   
    __________________________________________________________________________________________________
    activation_1 (Activation)       (None, 72, 72, 32)   0           batch_normalization_1[2][0]      
    __________________________________________________________________________________________________
    conv2d_2 (Conv2D)               (None, 72, 72, 64)   18432       activation_1[2][0]               
    __________________________________________________________________________________________________
    batch_normalization_2 (BatchNor (None, 72, 72, 64)   192         conv2d_2[2][0]                   
    __________________________________________________________________________________________________
    activation_2 (Activation)       (None, 72, 72, 64)   0           batch_normalization_2[2][0]      
    __________________________________________________________________________________________________
    max_pooling2d (MaxPooling2D)    (None, 35, 35, 64)   0           activation_2[2][0]               
    __________________________________________________________________________________________________
    conv2d_3 (Conv2D)               (None, 35, 35, 80)   5120        max_pooling2d[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_3 (BatchNor (None, 35, 35, 80)   240         conv2d_3[2][0]                   
    __________________________________________________________________________________________________
    activation_3 (Activation)       (None, 35, 35, 80)   0           batch_normalization_3[2][0]      
    __________________________________________________________________________________________________
    conv2d_4 (Conv2D)               (None, 33, 33, 192)  138240      activation_3[2][0]               
    __________________________________________________________________________________________________
    batch_normalization_4 (BatchNor (None, 33, 33, 192)  576         conv2d_4[2][0]                   
    __________________________________________________________________________________________________
    activation_4 (Activation)       (None, 33, 33, 192)  0           batch_normalization_4[2][0]      
    __________________________________________________________________________________________________
    max_pooling2d_1 (MaxPooling2D)  (None, 16, 16, 192)  0           activation_4[2][0]               
    __________________________________________________________________________________________________
    conv2d_8 (Conv2D)               (None, 16, 16, 64)   12288       max_pooling2d_1[2][0]            
    __________________________________________________________________________________________________
    batch_normalization_8 (BatchNor (None, 16, 16, 64)   192         conv2d_8[2][0]                   
    __________________________________________________________________________________________________
    activation_8 (Activation)       (None, 16, 16, 64)   0           batch_normalization_8[2][0]      
    __________________________________________________________________________________________________
    conv2d_6 (Conv2D)               (None, 16, 16, 48)   9216        max_pooling2d_1[2][0]            
    __________________________________________________________________________________________________
    conv2d_9 (Conv2D)               (None, 16, 16, 96)   55296       activation_8[2][0]               
    __________________________________________________________________________________________________
    batch_normalization_6 (BatchNor (None, 16, 16, 48)   144         conv2d_6[2][0]                   
    __________________________________________________________________________________________________
    batch_normalization_9 (BatchNor (None, 16, 16, 96)   288         conv2d_9[2][0]                   
    __________________________________________________________________________________________________
    activation_6 (Activation)       (None, 16, 16, 48)   0           batch_normalization_6[2][0]      
    __________________________________________________________________________________________________
    activation_9 (Activation)       (None, 16, 16, 96)   0           batch_normalization_9[2][0]      
    __________________________________________________________________________________________________
    average_pooling2d (AveragePooli (None, 16, 16, 192)  0           max_pooling2d_1[2][0]            
    __________________________________________________________________________________________________
    conv2d_5 (Conv2D)               (None, 16, 16, 64)   12288       max_pooling2d_1[2][0]            
    __________________________________________________________________________________________________
    conv2d_7 (Conv2D)               (None, 16, 16, 64)   76800       activation_6[2][0]               
    __________________________________________________________________________________________________
    conv2d_10 (Conv2D)              (None, 16, 16, 96)   82944       activation_9[2][0]               
    __________________________________________________________________________________________________
    conv2d_11 (Conv2D)              (None, 16, 16, 32)   6144        average_pooling2d[2][0]          
    __________________________________________________________________________________________________
    batch_normalization_5 (BatchNor (None, 16, 16, 64)   192         conv2d_5[2][0]                   
    __________________________________________________________________________________________________
    batch_normalization_7 (BatchNor (None, 16, 16, 64)   192         conv2d_7[2][0]                   
    __________________________________________________________________________________________________
    batch_normalization_10 (BatchNo (None, 16, 16, 96)   288         conv2d_10[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_11 (BatchNo (None, 16, 16, 32)   96          conv2d_11[2][0]                  
    __________________________________________________________________________________________________
    activation_5 (Activation)       (None, 16, 16, 64)   0           batch_normalization_5[2][0]      
    __________________________________________________________________________________________________
    activation_7 (Activation)       (None, 16, 16, 64)   0           batch_normalization_7[2][0]      
    __________________________________________________________________________________________________
    activation_10 (Activation)      (None, 16, 16, 96)   0           batch_normalization_10[2][0]     
    __________________________________________________________________________________________________
    activation_11 (Activation)      (None, 16, 16, 32)   0           batch_normalization_11[2][0]     
    __________________________________________________________________________________________________
    mixed0 (Concatenate)            (None, 16, 16, 256)  0           activation_5[2][0]               
                                                                     activation_7[2][0]               
                                                                     activation_10[2][0]              
                                                                     activation_11[2][0]              
    __________________________________________________________________________________________________
    conv2d_15 (Conv2D)              (None, 16, 16, 64)   16384       mixed0[2][0]                     
    __________________________________________________________________________________________________
    batch_normalization_15 (BatchNo (None, 16, 16, 64)   192         conv2d_15[2][0]                  
    __________________________________________________________________________________________________
    activation_15 (Activation)      (None, 16, 16, 64)   0           batch_normalization_15[2][0]     
    __________________________________________________________________________________________________
    conv2d_13 (Conv2D)              (None, 16, 16, 48)   12288       mixed0[2][0]                     
    __________________________________________________________________________________________________
    conv2d_16 (Conv2D)              (None, 16, 16, 96)   55296       activation_15[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_13 (BatchNo (None, 16, 16, 48)   144         conv2d_13[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_16 (BatchNo (None, 16, 16, 96)   288         conv2d_16[2][0]                  
    __________________________________________________________________________________________________
    activation_13 (Activation)      (None, 16, 16, 48)   0           batch_normalization_13[2][0]     
    __________________________________________________________________________________________________
    activation_16 (Activation)      (None, 16, 16, 96)   0           batch_normalization_16[2][0]     
    __________________________________________________________________________________________________
    average_pooling2d_1 (AveragePoo (None, 16, 16, 256)  0           mixed0[2][0]                     
    __________________________________________________________________________________________________
    conv2d_12 (Conv2D)              (None, 16, 16, 64)   16384       mixed0[2][0]                     
    __________________________________________________________________________________________________
    conv2d_14 (Conv2D)              (None, 16, 16, 64)   76800       activation_13[2][0]              
    __________________________________________________________________________________________________
    conv2d_17 (Conv2D)              (None, 16, 16, 96)   82944       activation_16[2][0]              
    __________________________________________________________________________________________________
    conv2d_18 (Conv2D)              (None, 16, 16, 64)   16384       average_pooling2d_1[2][0]        
    __________________________________________________________________________________________________
    batch_normalization_12 (BatchNo (None, 16, 16, 64)   192         conv2d_12[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_14 (BatchNo (None, 16, 16, 64)   192         conv2d_14[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_17 (BatchNo (None, 16, 16, 96)   288         conv2d_17[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_18 (BatchNo (None, 16, 16, 64)   192         conv2d_18[2][0]                  
    __________________________________________________________________________________________________
    activation_12 (Activation)      (None, 16, 16, 64)   0           batch_normalization_12[2][0]     
    __________________________________________________________________________________________________
    activation_14 (Activation)      (None, 16, 16, 64)   0           batch_normalization_14[2][0]     
    __________________________________________________________________________________________________
    activation_17 (Activation)      (None, 16, 16, 96)   0           batch_normalization_17[2][0]     
    __________________________________________________________________________________________________
    activation_18 (Activation)      (None, 16, 16, 64)   0           batch_normalization_18[2][0]     
    __________________________________________________________________________________________________
    mixed1 (Concatenate)            (None, 16, 16, 288)  0           activation_12[2][0]              
                                                                     activation_14[2][0]              
                                                                     activation_17[2][0]              
                                                                     activation_18[2][0]              
    __________________________________________________________________________________________________
    conv2d_22 (Conv2D)              (None, 16, 16, 64)   18432       mixed1[2][0]                     
    __________________________________________________________________________________________________
    batch_normalization_22 (BatchNo (None, 16, 16, 64)   192         conv2d_22[2][0]                  
    __________________________________________________________________________________________________
    activation_22 (Activation)      (None, 16, 16, 64)   0           batch_normalization_22[2][0]     
    __________________________________________________________________________________________________
    conv2d_20 (Conv2D)              (None, 16, 16, 48)   13824       mixed1[2][0]                     
    __________________________________________________________________________________________________
    conv2d_23 (Conv2D)              (None, 16, 16, 96)   55296       activation_22[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_20 (BatchNo (None, 16, 16, 48)   144         conv2d_20[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_23 (BatchNo (None, 16, 16, 96)   288         conv2d_23[2][0]                  
    __________________________________________________________________________________________________
    activation_20 (Activation)      (None, 16, 16, 48)   0           batch_normalization_20[2][0]     
    __________________________________________________________________________________________________
    activation_23 (Activation)      (None, 16, 16, 96)   0           batch_normalization_23[2][0]     
    __________________________________________________________________________________________________
    average_pooling2d_2 (AveragePoo (None, 16, 16, 288)  0           mixed1[2][0]                     
    __________________________________________________________________________________________________
    conv2d_19 (Conv2D)              (None, 16, 16, 64)   18432       mixed1[2][0]                     
    __________________________________________________________________________________________________
    conv2d_21 (Conv2D)              (None, 16, 16, 64)   76800       activation_20[2][0]              
    __________________________________________________________________________________________________
    conv2d_24 (Conv2D)              (None, 16, 16, 96)   82944       activation_23[2][0]              
    __________________________________________________________________________________________________
    conv2d_25 (Conv2D)              (None, 16, 16, 64)   18432       average_pooling2d_2[2][0]        
    __________________________________________________________________________________________________
    batch_normalization_19 (BatchNo (None, 16, 16, 64)   192         conv2d_19[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_21 (BatchNo (None, 16, 16, 64)   192         conv2d_21[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_24 (BatchNo (None, 16, 16, 96)   288         conv2d_24[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_25 (BatchNo (None, 16, 16, 64)   192         conv2d_25[2][0]                  
    __________________________________________________________________________________________________
    activation_19 (Activation)      (None, 16, 16, 64)   0           batch_normalization_19[2][0]     
    __________________________________________________________________________________________________
    activation_21 (Activation)      (None, 16, 16, 64)   0           batch_normalization_21[2][0]     
    __________________________________________________________________________________________________
    activation_24 (Activation)      (None, 16, 16, 96)   0           batch_normalization_24[2][0]     
    __________________________________________________________________________________________________
    activation_25 (Activation)      (None, 16, 16, 64)   0           batch_normalization_25[2][0]     
    __________________________________________________________________________________________________
    mixed2 (Concatenate)            (None, 16, 16, 288)  0           activation_19[2][0]              
                                                                     activation_21[2][0]              
                                                                     activation_24[2][0]              
                                                                     activation_25[2][0]              
    __________________________________________________________________________________________________
    conv2d_27 (Conv2D)              (None, 16, 16, 64)   18432       mixed2[2][0]                     
    __________________________________________________________________________________________________
    batch_normalization_27 (BatchNo (None, 16, 16, 64)   192         conv2d_27[2][0]                  
    __________________________________________________________________________________________________
    activation_27 (Activation)      (None, 16, 16, 64)   0           batch_normalization_27[2][0]     
    __________________________________________________________________________________________________
    conv2d_28 (Conv2D)              (None, 16, 16, 96)   55296       activation_27[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_28 (BatchNo (None, 16, 16, 96)   288         conv2d_28[2][0]                  
    __________________________________________________________________________________________________
    activation_28 (Activation)      (None, 16, 16, 96)   0           batch_normalization_28[2][0]     
    __________________________________________________________________________________________________
    conv2d_26 (Conv2D)              (None, 7, 7, 384)    995328      mixed2[2][0]                     
    __________________________________________________________________________________________________
    conv2d_29 (Conv2D)              (None, 7, 7, 96)     82944       activation_28[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_26 (BatchNo (None, 7, 7, 384)    1152        conv2d_26[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_29 (BatchNo (None, 7, 7, 96)     288         conv2d_29[2][0]                  
    __________________________________________________________________________________________________
    activation_26 (Activation)      (None, 7, 7, 384)    0           batch_normalization_26[2][0]     
    __________________________________________________________________________________________________
    activation_29 (Activation)      (None, 7, 7, 96)     0           batch_normalization_29[2][0]     
    __________________________________________________________________________________________________
    max_pooling2d_2 (MaxPooling2D)  (None, 7, 7, 288)    0           mixed2[2][0]                     
    __________________________________________________________________________________________________
    mixed3 (Concatenate)            (None, 7, 7, 768)    0           activation_26[2][0]              
                                                                     activation_29[2][0]              
                                                                     max_pooling2d_2[2][0]            
    __________________________________________________________________________________________________
    conv2d_34 (Conv2D)              (None, 7, 7, 128)    98304       mixed3[2][0]                     
    __________________________________________________________________________________________________
    batch_normalization_34 (BatchNo (None, 7, 7, 128)    384         conv2d_34[2][0]                  
    __________________________________________________________________________________________________
    activation_34 (Activation)      (None, 7, 7, 128)    0           batch_normalization_34[2][0]     
    __________________________________________________________________________________________________
    conv2d_35 (Conv2D)              (None, 7, 7, 128)    114688      activation_34[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_35 (BatchNo (None, 7, 7, 128)    384         conv2d_35[2][0]                  
    __________________________________________________________________________________________________
    activation_35 (Activation)      (None, 7, 7, 128)    0           batch_normalization_35[2][0]     
    __________________________________________________________________________________________________
    conv2d_31 (Conv2D)              (None, 7, 7, 128)    98304       mixed3[2][0]                     
    __________________________________________________________________________________________________
    conv2d_36 (Conv2D)              (None, 7, 7, 128)    114688      activation_35[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_31 (BatchNo (None, 7, 7, 128)    384         conv2d_31[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_36 (BatchNo (None, 7, 7, 128)    384         conv2d_36[2][0]                  
    __________________________________________________________________________________________________
    activation_31 (Activation)      (None, 7, 7, 128)    0           batch_normalization_31[2][0]     
    __________________________________________________________________________________________________
    activation_36 (Activation)      (None, 7, 7, 128)    0           batch_normalization_36[2][0]     
    __________________________________________________________________________________________________
    conv2d_32 (Conv2D)              (None, 7, 7, 128)    114688      activation_31[2][0]              
    __________________________________________________________________________________________________
    conv2d_37 (Conv2D)              (None, 7, 7, 128)    114688      activation_36[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_32 (BatchNo (None, 7, 7, 128)    384         conv2d_32[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_37 (BatchNo (None, 7, 7, 128)    384         conv2d_37[2][0]                  
    __________________________________________________________________________________________________
    activation_32 (Activation)      (None, 7, 7, 128)    0           batch_normalization_32[2][0]     
    __________________________________________________________________________________________________
    activation_37 (Activation)      (None, 7, 7, 128)    0           batch_normalization_37[2][0]     
    __________________________________________________________________________________________________
    average_pooling2d_3 (AveragePoo (None, 7, 7, 768)    0           mixed3[2][0]                     
    __________________________________________________________________________________________________
    conv2d_30 (Conv2D)              (None, 7, 7, 192)    147456      mixed3[2][0]                     
    __________________________________________________________________________________________________
    conv2d_33 (Conv2D)              (None, 7, 7, 192)    172032      activation_32[2][0]              
    __________________________________________________________________________________________________
    conv2d_38 (Conv2D)              (None, 7, 7, 192)    172032      activation_37[2][0]              
    __________________________________________________________________________________________________
    conv2d_39 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_3[2][0]        
    __________________________________________________________________________________________________
    batch_normalization_30 (BatchNo (None, 7, 7, 192)    576         conv2d_30[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_33 (BatchNo (None, 7, 7, 192)    576         conv2d_33[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_38 (BatchNo (None, 7, 7, 192)    576         conv2d_38[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_39 (BatchNo (None, 7, 7, 192)    576         conv2d_39[2][0]                  
    __________________________________________________________________________________________________
    activation_30 (Activation)      (None, 7, 7, 192)    0           batch_normalization_30[2][0]     
    __________________________________________________________________________________________________
    activation_33 (Activation)      (None, 7, 7, 192)    0           batch_normalization_33[2][0]     
    __________________________________________________________________________________________________
    activation_38 (Activation)      (None, 7, 7, 192)    0           batch_normalization_38[2][0]     
    __________________________________________________________________________________________________
    activation_39 (Activation)      (None, 7, 7, 192)    0           batch_normalization_39[2][0]     
    __________________________________________________________________________________________________
    mixed4 (Concatenate)            (None, 7, 7, 768)    0           activation_30[2][0]              
                                                                     activation_33[2][0]              
                                                                     activation_38[2][0]              
                                                                     activation_39[2][0]              
    __________________________________________________________________________________________________
    conv2d_44 (Conv2D)              (None, 7, 7, 160)    122880      mixed4[2][0]                     
    __________________________________________________________________________________________________
    batch_normalization_44 (BatchNo (None, 7, 7, 160)    480         conv2d_44[2][0]                  
    __________________________________________________________________________________________________
    activation_44 (Activation)      (None, 7, 7, 160)    0           batch_normalization_44[2][0]     
    __________________________________________________________________________________________________
    conv2d_45 (Conv2D)              (None, 7, 7, 160)    179200      activation_44[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_45 (BatchNo (None, 7, 7, 160)    480         conv2d_45[2][0]                  
    __________________________________________________________________________________________________
    activation_45 (Activation)      (None, 7, 7, 160)    0           batch_normalization_45[2][0]     
    __________________________________________________________________________________________________
    conv2d_41 (Conv2D)              (None, 7, 7, 160)    122880      mixed4[2][0]                     
    __________________________________________________________________________________________________
    conv2d_46 (Conv2D)              (None, 7, 7, 160)    179200      activation_45[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_41 (BatchNo (None, 7, 7, 160)    480         conv2d_41[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_46 (BatchNo (None, 7, 7, 160)    480         conv2d_46[2][0]                  
    __________________________________________________________________________________________________
    activation_41 (Activation)      (None, 7, 7, 160)    0           batch_normalization_41[2][0]     
    __________________________________________________________________________________________________
    activation_46 (Activation)      (None, 7, 7, 160)    0           batch_normalization_46[2][0]     
    __________________________________________________________________________________________________
    conv2d_42 (Conv2D)              (None, 7, 7, 160)    179200      activation_41[2][0]              
    __________________________________________________________________________________________________
    conv2d_47 (Conv2D)              (None, 7, 7, 160)    179200      activation_46[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_42 (BatchNo (None, 7, 7, 160)    480         conv2d_42[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_47 (BatchNo (None, 7, 7, 160)    480         conv2d_47[2][0]                  
    __________________________________________________________________________________________________
    activation_42 (Activation)      (None, 7, 7, 160)    0           batch_normalization_42[2][0]     
    __________________________________________________________________________________________________
    activation_47 (Activation)      (None, 7, 7, 160)    0           batch_normalization_47[2][0]     
    __________________________________________________________________________________________________
    average_pooling2d_4 (AveragePoo (None, 7, 7, 768)    0           mixed4[2][0]                     
    __________________________________________________________________________________________________
    conv2d_40 (Conv2D)              (None, 7, 7, 192)    147456      mixed4[2][0]                     
    __________________________________________________________________________________________________
    conv2d_43 (Conv2D)              (None, 7, 7, 192)    215040      activation_42[2][0]              
    __________________________________________________________________________________________________
    conv2d_48 (Conv2D)              (None, 7, 7, 192)    215040      activation_47[2][0]              
    __________________________________________________________________________________________________
    conv2d_49 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_4[2][0]        
    __________________________________________________________________________________________________
    batch_normalization_40 (BatchNo (None, 7, 7, 192)    576         conv2d_40[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_43 (BatchNo (None, 7, 7, 192)    576         conv2d_43[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_48 (BatchNo (None, 7, 7, 192)    576         conv2d_48[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_49 (BatchNo (None, 7, 7, 192)    576         conv2d_49[2][0]                  
    __________________________________________________________________________________________________
    activation_40 (Activation)      (None, 7, 7, 192)    0           batch_normalization_40[2][0]     
    __________________________________________________________________________________________________
    activation_43 (Activation)      (None, 7, 7, 192)    0           batch_normalization_43[2][0]     
    __________________________________________________________________________________________________
    activation_48 (Activation)      (None, 7, 7, 192)    0           batch_normalization_48[2][0]     
    __________________________________________________________________________________________________
    activation_49 (Activation)      (None, 7, 7, 192)    0           batch_normalization_49[2][0]     
    __________________________________________________________________________________________________
    mixed5 (Concatenate)            (None, 7, 7, 768)    0           activation_40[2][0]              
                                                                     activation_43[2][0]              
                                                                     activation_48[2][0]              
                                                                     activation_49[2][0]              
    __________________________________________________________________________________________________
    conv2d_54 (Conv2D)              (None, 7, 7, 160)    122880      mixed5[2][0]                     
    __________________________________________________________________________________________________
    batch_normalization_54 (BatchNo (None, 7, 7, 160)    480         conv2d_54[2][0]                  
    __________________________________________________________________________________________________
    activation_54 (Activation)      (None, 7, 7, 160)    0           batch_normalization_54[2][0]     
    __________________________________________________________________________________________________
    conv2d_55 (Conv2D)              (None, 7, 7, 160)    179200      activation_54[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_55 (BatchNo (None, 7, 7, 160)    480         conv2d_55[2][0]                  
    __________________________________________________________________________________________________
    activation_55 (Activation)      (None, 7, 7, 160)    0           batch_normalization_55[2][0]     
    __________________________________________________________________________________________________
    conv2d_51 (Conv2D)              (None, 7, 7, 160)    122880      mixed5[2][0]                     
    __________________________________________________________________________________________________
    conv2d_56 (Conv2D)              (None, 7, 7, 160)    179200      activation_55[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_51 (BatchNo (None, 7, 7, 160)    480         conv2d_51[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_56 (BatchNo (None, 7, 7, 160)    480         conv2d_56[2][0]                  
    __________________________________________________________________________________________________
    activation_51 (Activation)      (None, 7, 7, 160)    0           batch_normalization_51[2][0]     
    __________________________________________________________________________________________________
    activation_56 (Activation)      (None, 7, 7, 160)    0           batch_normalization_56[2][0]     
    __________________________________________________________________________________________________
    conv2d_52 (Conv2D)              (None, 7, 7, 160)    179200      activation_51[2][0]              
    __________________________________________________________________________________________________
    conv2d_57 (Conv2D)              (None, 7, 7, 160)    179200      activation_56[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_52 (BatchNo (None, 7, 7, 160)    480         conv2d_52[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_57 (BatchNo (None, 7, 7, 160)    480         conv2d_57[2][0]                  
    __________________________________________________________________________________________________
    activation_52 (Activation)      (None, 7, 7, 160)    0           batch_normalization_52[2][0]     
    __________________________________________________________________________________________________
    activation_57 (Activation)      (None, 7, 7, 160)    0           batch_normalization_57[2][0]     
    __________________________________________________________________________________________________
    average_pooling2d_5 (AveragePoo (None, 7, 7, 768)    0           mixed5[2][0]                     
    __________________________________________________________________________________________________
    conv2d_50 (Conv2D)              (None, 7, 7, 192)    147456      mixed5[2][0]                     
    __________________________________________________________________________________________________
    conv2d_53 (Conv2D)              (None, 7, 7, 192)    215040      activation_52[2][0]              
    __________________________________________________________________________________________________
    conv2d_58 (Conv2D)              (None, 7, 7, 192)    215040      activation_57[2][0]              
    __________________________________________________________________________________________________
    conv2d_59 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_5[2][0]        
    __________________________________________________________________________________________________
    batch_normalization_50 (BatchNo (None, 7, 7, 192)    576         conv2d_50[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_53 (BatchNo (None, 7, 7, 192)    576         conv2d_53[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_58 (BatchNo (None, 7, 7, 192)    576         conv2d_58[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_59 (BatchNo (None, 7, 7, 192)    576         conv2d_59[2][0]                  
    __________________________________________________________________________________________________
    activation_50 (Activation)      (None, 7, 7, 192)    0           batch_normalization_50[2][0]     
    __________________________________________________________________________________________________
    activation_53 (Activation)      (None, 7, 7, 192)    0           batch_normalization_53[2][0]     
    __________________________________________________________________________________________________
    activation_58 (Activation)      (None, 7, 7, 192)    0           batch_normalization_58[2][0]     
    __________________________________________________________________________________________________
    activation_59 (Activation)      (None, 7, 7, 192)    0           batch_normalization_59[2][0]     
    __________________________________________________________________________________________________
    mixed6 (Concatenate)            (None, 7, 7, 768)    0           activation_50[2][0]              
                                                                     activation_53[2][0]              
                                                                     activation_58[2][0]              
                                                                     activation_59[2][0]              
    __________________________________________________________________________________________________
    conv2d_64 (Conv2D)              (None, 7, 7, 192)    147456      mixed6[2][0]                     
    __________________________________________________________________________________________________
    batch_normalization_64 (BatchNo (None, 7, 7, 192)    576         conv2d_64[2][0]                  
    __________________________________________________________________________________________________
    activation_64 (Activation)      (None, 7, 7, 192)    0           batch_normalization_64[2][0]     
    __________________________________________________________________________________________________
    conv2d_65 (Conv2D)              (None, 7, 7, 192)    258048      activation_64[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_65 (BatchNo (None, 7, 7, 192)    576         conv2d_65[2][0]                  
    __________________________________________________________________________________________________
    activation_65 (Activation)      (None, 7, 7, 192)    0           batch_normalization_65[2][0]     
    __________________________________________________________________________________________________
    conv2d_61 (Conv2D)              (None, 7, 7, 192)    147456      mixed6[2][0]                     
    __________________________________________________________________________________________________
    conv2d_66 (Conv2D)              (None, 7, 7, 192)    258048      activation_65[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_61 (BatchNo (None, 7, 7, 192)    576         conv2d_61[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_66 (BatchNo (None, 7, 7, 192)    576         conv2d_66[2][0]                  
    __________________________________________________________________________________________________
    activation_61 (Activation)      (None, 7, 7, 192)    0           batch_normalization_61[2][0]     
    __________________________________________________________________________________________________
    activation_66 (Activation)      (None, 7, 7, 192)    0           batch_normalization_66[2][0]     
    __________________________________________________________________________________________________
    conv2d_62 (Conv2D)              (None, 7, 7, 192)    258048      activation_61[2][0]              
    __________________________________________________________________________________________________
    conv2d_67 (Conv2D)              (None, 7, 7, 192)    258048      activation_66[2][0]              
    __________________________________________________________________________________________________
    batch_normalization_62 (BatchNo (None, 7, 7, 192)    576         conv2d_62[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_67 (BatchNo (None, 7, 7, 192)    576         conv2d_67[2][0]                  
    __________________________________________________________________________________________________
    activation_62 (Activation)      (None, 7, 7, 192)    0           batch_normalization_62[2][0]     
    __________________________________________________________________________________________________
    activation_67 (Activation)      (None, 7, 7, 192)    0           batch_normalization_67[2][0]     
    __________________________________________________________________________________________________
    average_pooling2d_6 (AveragePoo (None, 7, 7, 768)    0           mixed6[2][0]                     
    __________________________________________________________________________________________________
    conv2d_60 (Conv2D)              (None, 7, 7, 192)    147456      mixed6[2][0]                     
    __________________________________________________________________________________________________
    conv2d_63 (Conv2D)              (None, 7, 7, 192)    258048      activation_62[2][0]              
    __________________________________________________________________________________________________
    conv2d_68 (Conv2D)              (None, 7, 7, 192)    258048      activation_67[2][0]              
    __________________________________________________________________________________________________
    conv2d_69 (Conv2D)              (None, 7, 7, 192)    147456      average_pooling2d_6[2][0]        
    __________________________________________________________________________________________________
    batch_normalization_60 (BatchNo (None, 7, 7, 192)    576         conv2d_60[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_63 (BatchNo (None, 7, 7, 192)    576         conv2d_63[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_68 (BatchNo (None, 7, 7, 192)    576         conv2d_68[2][0]                  
    __________________________________________________________________________________________________
    batch_normalization_69 (BatchNo (None, 7, 7, 192)    576         conv2d_69[2][0]                  
    __________________________________________________________________________________________________
    activation_60 (Activation)      (None, 7, 7, 192)    0           batch_normalization_60[2][0]     
    __________________________________________________________________________________________________
    activation_63 (Activation)      (None, 7, 7, 192)    0           batch_normalization_63[2][0]     
    __________________________________________________________________________________________________
    activation_68 (Activation)      (None, 7, 7, 192)    0           batch_normalization_68[2][0]     
    __________________________________________________________________________________________________
    activation_69 (Activation)      (None, 7, 7, 192)    0           batch_normalization_69[2][0]     
    __________________________________________________________________________________________________
    mixed7 (Concatenate)            (None, 7, 7, 768)    0           activation_60[2][0]              
                                                                     activation_63[2][0]              
                                                                     activation_68[2][0]              
                                                                     activation_69[2][0]              
    __________________________________________________________________________________________________
    flatten (Flatten)               (None, 37632)        0           mixed7[2][0]                     
    __________________________________________________________________________________________________
    dense (Dense)                   (None, 1024)         38536192    flatten[2][0]                    
    __________________________________________________________________________________________________
    dropout (Dropout)               (None, 1024)         0           dense[2][0]                      
    __________________________________________________________________________________________________
    dense_1 (Dense)                 (None, 1)            1025        dropout[2][0]                    
    ==================================================================================================
    Total params: 47,512,481
    Trainable params: 38,537,217
    Non-trainable params: 8,975,264
    __________________________________________________________________________________________________
    


```python


_, pruned_keras_file = tempfile.mkstemp('.h5')
tf.keras.models.save_model(model_for_export, pruned_keras_file, include_optimizer=False)

def get_gzipped_model_size(file):
  # Returns size of gzipped model, in bytes.
  import os
  import zipfile

  _, zipped_file = tempfile.mkstemp('.zip')
  with zipfile.ZipFile(zipped_file, 'w', compression=zipfile.ZIP_DEFLATED) as f:
    f.write(file)

  return os.path.getsize(zipped_file)


print("Size of gzipped baseline Keras model: %.2f bytes" % (get_gzipped_model_size(keras_file)))
print("Size of gzipped pruned Keras model: %.2f bytes" % (get_gzipped_model_size(pruned_keras_file)))
```

    Size of gzipped baseline Keras model: 175984925.00 bytes
    Size of gzipped pruned Keras model: 35619648.00 bytes
    


```python
import tensorflow as tf


converter = tf.lite.TFLiteConverter.from_keras_model(model)
converter.optimizations = [tf.lite.Optimize.DEFAULT]
tflite_quant_model = converter.convert()


```

    INFO:tensorflow:Assets written to: /tmp/tmpruqlqe78/assets
    

    INFO:tensorflow:Assets written to: /tmp/tmpruqlqe78/assets
    


```python
open("converted_model.tflite", "wb").write(tflite_quant_model)

print("Size of gzipped baseline Keras model: %.2f bytes" % (os.path.getsize("converted_model.tflite")))
```

    Size of gzipped baseline Keras model: 47756784.00 bytes
    


```python
from tensorflow.keras.models import load_model

model = load_model(pruned_keras_file)
import numpy as np

for i, w in enumerate(model.get_weights()):
    print(
        "{} -- Total:{}, Zeros: {:.2f}%".format(
            model.weights[i].name, w.size, np.sum(w == 0) / w.size * 100
        )
    )
```

    WARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.
    

    WARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.
    

    conv2d/kernel:0 -- Total:864, Zeros: 90.05%
    batch_normalization/beta:0 -- Total:32, Zeros: 0.00%
    batch_normalization/moving_mean:0 -- Total:32, Zeros: 0.00%
    batch_normalization/moving_variance:0 -- Total:32, Zeros: 0.00%
    conv2d_1/kernel:0 -- Total:9216, Zeros: 90.00%
    batch_normalization_1/beta:0 -- Total:32, Zeros: 0.00%
    batch_normalization_1/moving_mean:0 -- Total:32, Zeros: 0.00%
    batch_normalization_1/moving_variance:0 -- Total:32, Zeros: 0.00%
    conv2d_2/kernel:0 -- Total:18432, Zeros: 90.00%
    batch_normalization_2/beta:0 -- Total:64, Zeros: 0.00%
    batch_normalization_2/moving_mean:0 -- Total:64, Zeros: 0.00%
    batch_normalization_2/moving_variance:0 -- Total:64, Zeros: 0.00%
    conv2d_3/kernel:0 -- Total:5120, Zeros: 90.00%
    batch_normalization_3/beta:0 -- Total:80, Zeros: 0.00%
    batch_normalization_3/moving_mean:0 -- Total:80, Zeros: 0.00%
    batch_normalization_3/moving_variance:0 -- Total:80, Zeros: 0.00%
    conv2d_4/kernel:0 -- Total:138240, Zeros: 90.00%
    batch_normalization_4/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_4/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_4/moving_variance:0 -- Total:192, Zeros: 0.00%
    conv2d_8/kernel:0 -- Total:12288, Zeros: 90.00%
    batch_normalization_8/beta:0 -- Total:64, Zeros: 0.00%
    batch_normalization_8/moving_mean:0 -- Total:64, Zeros: 0.00%
    batch_normalization_8/moving_variance:0 -- Total:64, Zeros: 0.00%
    conv2d_6/kernel:0 -- Total:9216, Zeros: 90.00%
    conv2d_9/kernel:0 -- Total:55296, Zeros: 90.00%
    batch_normalization_6/beta:0 -- Total:48, Zeros: 0.00%
    batch_normalization_6/moving_mean:0 -- Total:48, Zeros: 0.00%
    batch_normalization_6/moving_variance:0 -- Total:48, Zeros: 0.00%
    batch_normalization_9/beta:0 -- Total:96, Zeros: 0.00%
    batch_normalization_9/moving_mean:0 -- Total:96, Zeros: 0.00%
    batch_normalization_9/moving_variance:0 -- Total:96, Zeros: 0.00%
    conv2d_5/kernel:0 -- Total:12288, Zeros: 90.00%
    conv2d_7/kernel:0 -- Total:76800, Zeros: 90.00%
    conv2d_10/kernel:0 -- Total:82944, Zeros: 90.00%
    conv2d_11/kernel:0 -- Total:6144, Zeros: 90.01%
    batch_normalization_5/beta:0 -- Total:64, Zeros: 0.00%
    batch_normalization_5/moving_mean:0 -- Total:64, Zeros: 0.00%
    batch_normalization_5/moving_variance:0 -- Total:64, Zeros: 0.00%
    batch_normalization_7/beta:0 -- Total:64, Zeros: 0.00%
    batch_normalization_7/moving_mean:0 -- Total:64, Zeros: 0.00%
    batch_normalization_7/moving_variance:0 -- Total:64, Zeros: 0.00%
    batch_normalization_10/beta:0 -- Total:96, Zeros: 0.00%
    batch_normalization_10/moving_mean:0 -- Total:96, Zeros: 0.00%
    batch_normalization_10/moving_variance:0 -- Total:96, Zeros: 0.00%
    batch_normalization_11/beta:0 -- Total:32, Zeros: 0.00%
    batch_normalization_11/moving_mean:0 -- Total:32, Zeros: 0.00%
    batch_normalization_11/moving_variance:0 -- Total:32, Zeros: 0.00%
    conv2d_15/kernel:0 -- Total:16384, Zeros: 90.00%
    batch_normalization_15/beta:0 -- Total:64, Zeros: 0.00%
    batch_normalization_15/moving_mean:0 -- Total:64, Zeros: 0.00%
    batch_normalization_15/moving_variance:0 -- Total:64, Zeros: 0.00%
    conv2d_13/kernel:0 -- Total:12288, Zeros: 90.00%
    conv2d_16/kernel:0 -- Total:55296, Zeros: 90.00%
    batch_normalization_13/beta:0 -- Total:48, Zeros: 0.00%
    batch_normalization_13/moving_mean:0 -- Total:48, Zeros: 0.00%
    batch_normalization_13/moving_variance:0 -- Total:48, Zeros: 0.00%
    batch_normalization_16/beta:0 -- Total:96, Zeros: 0.00%
    batch_normalization_16/moving_mean:0 -- Total:96, Zeros: 0.00%
    batch_normalization_16/moving_variance:0 -- Total:96, Zeros: 0.00%
    conv2d_12/kernel:0 -- Total:16384, Zeros: 90.00%
    conv2d_14/kernel:0 -- Total:76800, Zeros: 90.00%
    conv2d_17/kernel:0 -- Total:82944, Zeros: 90.00%
    conv2d_18/kernel:0 -- Total:16384, Zeros: 90.00%
    batch_normalization_12/beta:0 -- Total:64, Zeros: 0.00%
    batch_normalization_12/moving_mean:0 -- Total:64, Zeros: 0.00%
    batch_normalization_12/moving_variance:0 -- Total:64, Zeros: 0.00%
    batch_normalization_14/beta:0 -- Total:64, Zeros: 0.00%
    batch_normalization_14/moving_mean:0 -- Total:64, Zeros: 0.00%
    batch_normalization_14/moving_variance:0 -- Total:64, Zeros: 0.00%
    batch_normalization_17/beta:0 -- Total:96, Zeros: 0.00%
    batch_normalization_17/moving_mean:0 -- Total:96, Zeros: 0.00%
    batch_normalization_17/moving_variance:0 -- Total:96, Zeros: 0.00%
    batch_normalization_18/beta:0 -- Total:64, Zeros: 0.00%
    batch_normalization_18/moving_mean:0 -- Total:64, Zeros: 0.00%
    batch_normalization_18/moving_variance:0 -- Total:64, Zeros: 0.00%
    conv2d_22/kernel:0 -- Total:18432, Zeros: 90.00%
    batch_normalization_22/beta:0 -- Total:64, Zeros: 0.00%
    batch_normalization_22/moving_mean:0 -- Total:64, Zeros: 0.00%
    batch_normalization_22/moving_variance:0 -- Total:64, Zeros: 0.00%
    conv2d_20/kernel:0 -- Total:13824, Zeros: 90.00%
    conv2d_23/kernel:0 -- Total:55296, Zeros: 90.00%
    batch_normalization_20/beta:0 -- Total:48, Zeros: 0.00%
    batch_normalization_20/moving_mean:0 -- Total:48, Zeros: 0.00%
    batch_normalization_20/moving_variance:0 -- Total:48, Zeros: 0.00%
    batch_normalization_23/beta:0 -- Total:96, Zeros: 0.00%
    batch_normalization_23/moving_mean:0 -- Total:96, Zeros: 0.00%
    batch_normalization_23/moving_variance:0 -- Total:96, Zeros: 0.00%
    conv2d_19/kernel:0 -- Total:18432, Zeros: 90.00%
    conv2d_21/kernel:0 -- Total:76800, Zeros: 90.00%
    conv2d_24/kernel:0 -- Total:82944, Zeros: 90.00%
    conv2d_25/kernel:0 -- Total:18432, Zeros: 90.00%
    batch_normalization_19/beta:0 -- Total:64, Zeros: 0.00%
    batch_normalization_19/moving_mean:0 -- Total:64, Zeros: 0.00%
    batch_normalization_19/moving_variance:0 -- Total:64, Zeros: 0.00%
    batch_normalization_21/beta:0 -- Total:64, Zeros: 0.00%
    batch_normalization_21/moving_mean:0 -- Total:64, Zeros: 0.00%
    batch_normalization_21/moving_variance:0 -- Total:64, Zeros: 0.00%
    batch_normalization_24/beta:0 -- Total:96, Zeros: 0.00%
    batch_normalization_24/moving_mean:0 -- Total:96, Zeros: 0.00%
    batch_normalization_24/moving_variance:0 -- Total:96, Zeros: 0.00%
    batch_normalization_25/beta:0 -- Total:64, Zeros: 0.00%
    batch_normalization_25/moving_mean:0 -- Total:64, Zeros: 0.00%
    batch_normalization_25/moving_variance:0 -- Total:64, Zeros: 0.00%
    conv2d_27/kernel:0 -- Total:18432, Zeros: 90.00%
    batch_normalization_27/beta:0 -- Total:64, Zeros: 0.00%
    batch_normalization_27/moving_mean:0 -- Total:64, Zeros: 0.00%
    batch_normalization_27/moving_variance:0 -- Total:64, Zeros: 0.00%
    conv2d_28/kernel:0 -- Total:55296, Zeros: 90.00%
    batch_normalization_28/beta:0 -- Total:96, Zeros: 0.00%
    batch_normalization_28/moving_mean:0 -- Total:96, Zeros: 0.00%
    batch_normalization_28/moving_variance:0 -- Total:96, Zeros: 0.00%
    conv2d_26/kernel:0 -- Total:995328, Zeros: 90.00%
    conv2d_29/kernel:0 -- Total:82944, Zeros: 90.00%
    batch_normalization_26/beta:0 -- Total:384, Zeros: 0.00%
    batch_normalization_26/moving_mean:0 -- Total:384, Zeros: 0.00%
    batch_normalization_26/moving_variance:0 -- Total:384, Zeros: 0.00%
    batch_normalization_29/beta:0 -- Total:96, Zeros: 0.00%
    batch_normalization_29/moving_mean:0 -- Total:96, Zeros: 0.00%
    batch_normalization_29/moving_variance:0 -- Total:96, Zeros: 0.00%
    conv2d_34/kernel:0 -- Total:98304, Zeros: 90.00%
    batch_normalization_34/beta:0 -- Total:128, Zeros: 0.00%
    batch_normalization_34/moving_mean:0 -- Total:128, Zeros: 0.00%
    batch_normalization_34/moving_variance:0 -- Total:128, Zeros: 0.00%
    conv2d_35/kernel:0 -- Total:114688, Zeros: 90.00%
    batch_normalization_35/beta:0 -- Total:128, Zeros: 0.00%
    batch_normalization_35/moving_mean:0 -- Total:128, Zeros: 0.00%
    batch_normalization_35/moving_variance:0 -- Total:128, Zeros: 0.00%
    conv2d_31/kernel:0 -- Total:98304, Zeros: 90.00%
    conv2d_36/kernel:0 -- Total:114688, Zeros: 90.00%
    batch_normalization_31/beta:0 -- Total:128, Zeros: 0.00%
    batch_normalization_31/moving_mean:0 -- Total:128, Zeros: 0.00%
    batch_normalization_31/moving_variance:0 -- Total:128, Zeros: 0.00%
    batch_normalization_36/beta:0 -- Total:128, Zeros: 0.00%
    batch_normalization_36/moving_mean:0 -- Total:128, Zeros: 0.00%
    batch_normalization_36/moving_variance:0 -- Total:128, Zeros: 0.00%
    conv2d_32/kernel:0 -- Total:114688, Zeros: 90.00%
    conv2d_37/kernel:0 -- Total:114688, Zeros: 90.00%
    batch_normalization_32/beta:0 -- Total:128, Zeros: 0.00%
    batch_normalization_32/moving_mean:0 -- Total:128, Zeros: 0.00%
    batch_normalization_32/moving_variance:0 -- Total:128, Zeros: 0.00%
    batch_normalization_37/beta:0 -- Total:128, Zeros: 0.00%
    batch_normalization_37/moving_mean:0 -- Total:128, Zeros: 0.00%
    batch_normalization_37/moving_variance:0 -- Total:128, Zeros: 0.00%
    conv2d_30/kernel:0 -- Total:147456, Zeros: 90.00%
    conv2d_33/kernel:0 -- Total:172032, Zeros: 90.00%
    conv2d_38/kernel:0 -- Total:172032, Zeros: 90.00%
    conv2d_39/kernel:0 -- Total:147456, Zeros: 90.00%
    batch_normalization_30/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_30/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_30/moving_variance:0 -- Total:192, Zeros: 0.00%
    batch_normalization_33/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_33/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_33/moving_variance:0 -- Total:192, Zeros: 0.00%
    batch_normalization_38/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_38/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_38/moving_variance:0 -- Total:192, Zeros: 0.00%
    batch_normalization_39/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_39/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_39/moving_variance:0 -- Total:192, Zeros: 0.00%
    conv2d_44/kernel:0 -- Total:122880, Zeros: 90.00%
    batch_normalization_44/beta:0 -- Total:160, Zeros: 0.00%
    batch_normalization_44/moving_mean:0 -- Total:160, Zeros: 0.00%
    batch_normalization_44/moving_variance:0 -- Total:160, Zeros: 0.00%
    conv2d_45/kernel:0 -- Total:179200, Zeros: 90.00%
    batch_normalization_45/beta:0 -- Total:160, Zeros: 0.00%
    batch_normalization_45/moving_mean:0 -- Total:160, Zeros: 0.00%
    batch_normalization_45/moving_variance:0 -- Total:160, Zeros: 0.00%
    conv2d_41/kernel:0 -- Total:122880, Zeros: 90.00%
    conv2d_46/kernel:0 -- Total:179200, Zeros: 90.00%
    batch_normalization_41/beta:0 -- Total:160, Zeros: 0.00%
    batch_normalization_41/moving_mean:0 -- Total:160, Zeros: 0.00%
    batch_normalization_41/moving_variance:0 -- Total:160, Zeros: 0.00%
    batch_normalization_46/beta:0 -- Total:160, Zeros: 0.00%
    batch_normalization_46/moving_mean:0 -- Total:160, Zeros: 0.00%
    batch_normalization_46/moving_variance:0 -- Total:160, Zeros: 0.00%
    conv2d_42/kernel:0 -- Total:179200, Zeros: 90.00%
    conv2d_47/kernel:0 -- Total:179200, Zeros: 90.00%
    batch_normalization_42/beta:0 -- Total:160, Zeros: 0.00%
    batch_normalization_42/moving_mean:0 -- Total:160, Zeros: 0.00%
    batch_normalization_42/moving_variance:0 -- Total:160, Zeros: 0.00%
    batch_normalization_47/beta:0 -- Total:160, Zeros: 0.00%
    batch_normalization_47/moving_mean:0 -- Total:160, Zeros: 0.00%
    batch_normalization_47/moving_variance:0 -- Total:160, Zeros: 0.00%
    conv2d_40/kernel:0 -- Total:147456, Zeros: 90.00%
    conv2d_43/kernel:0 -- Total:215040, Zeros: 90.00%
    conv2d_48/kernel:0 -- Total:215040, Zeros: 90.00%
    conv2d_49/kernel:0 -- Total:147456, Zeros: 90.00%
    batch_normalization_40/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_40/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_40/moving_variance:0 -- Total:192, Zeros: 0.00%
    batch_normalization_43/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_43/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_43/moving_variance:0 -- Total:192, Zeros: 0.00%
    batch_normalization_48/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_48/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_48/moving_variance:0 -- Total:192, Zeros: 0.00%
    batch_normalization_49/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_49/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_49/moving_variance:0 -- Total:192, Zeros: 0.00%
    conv2d_54/kernel:0 -- Total:122880, Zeros: 90.00%
    batch_normalization_54/beta:0 -- Total:160, Zeros: 0.00%
    batch_normalization_54/moving_mean:0 -- Total:160, Zeros: 0.00%
    batch_normalization_54/moving_variance:0 -- Total:160, Zeros: 0.00%
    conv2d_55/kernel:0 -- Total:179200, Zeros: 90.00%
    batch_normalization_55/beta:0 -- Total:160, Zeros: 0.00%
    batch_normalization_55/moving_mean:0 -- Total:160, Zeros: 0.00%
    batch_normalization_55/moving_variance:0 -- Total:160, Zeros: 0.00%
    conv2d_51/kernel:0 -- Total:122880, Zeros: 90.00%
    conv2d_56/kernel:0 -- Total:179200, Zeros: 90.00%
    batch_normalization_51/beta:0 -- Total:160, Zeros: 0.00%
    batch_normalization_51/moving_mean:0 -- Total:160, Zeros: 0.00%
    batch_normalization_51/moving_variance:0 -- Total:160, Zeros: 0.00%
    batch_normalization_56/beta:0 -- Total:160, Zeros: 0.00%
    batch_normalization_56/moving_mean:0 -- Total:160, Zeros: 0.00%
    batch_normalization_56/moving_variance:0 -- Total:160, Zeros: 0.00%
    conv2d_52/kernel:0 -- Total:179200, Zeros: 90.00%
    conv2d_57/kernel:0 -- Total:179200, Zeros: 90.00%
    batch_normalization_52/beta:0 -- Total:160, Zeros: 0.00%
    batch_normalization_52/moving_mean:0 -- Total:160, Zeros: 0.00%
    batch_normalization_52/moving_variance:0 -- Total:160, Zeros: 0.00%
    batch_normalization_57/beta:0 -- Total:160, Zeros: 0.00%
    batch_normalization_57/moving_mean:0 -- Total:160, Zeros: 0.00%
    batch_normalization_57/moving_variance:0 -- Total:160, Zeros: 0.00%
    conv2d_50/kernel:0 -- Total:147456, Zeros: 90.00%
    conv2d_53/kernel:0 -- Total:215040, Zeros: 90.00%
    conv2d_58/kernel:0 -- Total:215040, Zeros: 90.00%
    conv2d_59/kernel:0 -- Total:147456, Zeros: 90.00%
    batch_normalization_50/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_50/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_50/moving_variance:0 -- Total:192, Zeros: 0.00%
    batch_normalization_53/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_53/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_53/moving_variance:0 -- Total:192, Zeros: 0.00%
    batch_normalization_58/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_58/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_58/moving_variance:0 -- Total:192, Zeros: 0.00%
    batch_normalization_59/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_59/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_59/moving_variance:0 -- Total:192, Zeros: 0.00%
    conv2d_64/kernel:0 -- Total:147456, Zeros: 90.00%
    batch_normalization_64/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_64/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_64/moving_variance:0 -- Total:192, Zeros: 0.00%
    conv2d_65/kernel:0 -- Total:258048, Zeros: 90.00%
    batch_normalization_65/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_65/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_65/moving_variance:0 -- Total:192, Zeros: 0.00%
    conv2d_61/kernel:0 -- Total:147456, Zeros: 90.00%
    conv2d_66/kernel:0 -- Total:258048, Zeros: 90.00%
    batch_normalization_61/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_61/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_61/moving_variance:0 -- Total:192, Zeros: 0.00%
    batch_normalization_66/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_66/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_66/moving_variance:0 -- Total:192, Zeros: 0.00%
    conv2d_62/kernel:0 -- Total:258048, Zeros: 90.00%
    conv2d_67/kernel:0 -- Total:258048, Zeros: 90.00%
    batch_normalization_62/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_62/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_62/moving_variance:0 -- Total:192, Zeros: 0.00%
    batch_normalization_67/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_67/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_67/moving_variance:0 -- Total:192, Zeros: 0.00%
    conv2d_60/kernel:0 -- Total:147456, Zeros: 90.00%
    conv2d_63/kernel:0 -- Total:258048, Zeros: 90.00%
    conv2d_68/kernel:0 -- Total:258048, Zeros: 90.00%
    conv2d_69/kernel:0 -- Total:147456, Zeros: 90.00%
    batch_normalization_60/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_60/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_60/moving_variance:0 -- Total:192, Zeros: 0.00%
    batch_normalization_63/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_63/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_63/moving_variance:0 -- Total:192, Zeros: 0.00%
    batch_normalization_68/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_68/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_68/moving_variance:0 -- Total:192, Zeros: 0.00%
    batch_normalization_69/beta:0 -- Total:192, Zeros: 0.00%
    batch_normalization_69/moving_mean:0 -- Total:192, Zeros: 0.00%
    batch_normalization_69/moving_variance:0 -- Total:192, Zeros: 0.00%
    dense/kernel:0 -- Total:38535168, Zeros: 90.00%
    dense/bias:0 -- Total:1024, Zeros: 0.00%
    dense_1/kernel:0 -- Total:1024, Zeros: 90.04%
    dense_1/bias:0 -- Total:1, Zeros: 0.00%
    

# vgg 16


```python
vgg_16 = tf.keras.applications.VGG16(
    include_top = False,
    input_shape = (150, 150, 3), 
    weights='imagenet'
)




vgg_16.summary()
```

    Model: "vgg16"
    _________________________________________________________________
    Layer (type)                 Output Shape              Param #   
    =================================================================
    input_2 (InputLayer)         [(None, 150, 150, 3)]     0         
    _________________________________________________________________
    block1_conv1 (Conv2D)        (None, 150, 150, 64)      1792      
    _________________________________________________________________
    block1_conv2 (Conv2D)        (None, 150, 150, 64)      36928     
    _________________________________________________________________
    block1_pool (MaxPooling2D)   (None, 75, 75, 64)        0         
    _________________________________________________________________
    block2_conv1 (Conv2D)        (None, 75, 75, 128)       73856     
    _________________________________________________________________
    block2_conv2 (Conv2D)        (None, 75, 75, 128)       147584    
    _________________________________________________________________
    block2_pool (MaxPooling2D)   (None, 37, 37, 128)       0         
    _________________________________________________________________
    block3_conv1 (Conv2D)        (None, 37, 37, 256)       295168    
    _________________________________________________________________
    block3_conv2 (Conv2D)        (None, 37, 37, 256)       590080    
    _________________________________________________________________
    block3_conv3 (Conv2D)        (None, 37, 37, 256)       590080    
    _________________________________________________________________
    block3_pool (MaxPooling2D)   (None, 18, 18, 256)       0         
    _________________________________________________________________
    block4_conv1 (Conv2D)        (None, 18, 18, 512)       1180160   
    _________________________________________________________________
    block4_conv2 (Conv2D)        (None, 18, 18, 512)       2359808   
    _________________________________________________________________
    block4_conv3 (Conv2D)        (None, 18, 18, 512)       2359808   
    _________________________________________________________________
    block4_pool (MaxPooling2D)   (None, 9, 9, 512)         0         
    _________________________________________________________________
    block5_conv1 (Conv2D)        (None, 9, 9, 512)         2359808   
    _________________________________________________________________
    block5_conv2 (Conv2D)        (None, 9, 9, 512)         2359808   
    _________________________________________________________________
    block5_conv3 (Conv2D)        (None, 9, 9, 512)         2359808   
    _________________________________________________________________
    block5_pool (MaxPooling2D)   (None, 4, 4, 512)         0         
    =================================================================
    Total params: 14,714,688
    Trainable params: 14,714,688
    Non-trainable params: 0
    _________________________________________________________________
    


```python
last_layer = vgg_16.get_layer('block5_pool')
print('last layer output shape: ', last_layer.output_shape)
last_output = last_layer.output

from tensorflow.keras.optimizers import RMSprop

# Flatten the output layer to 1 dimension
y = layers.Flatten()(last_output)
# Add a fully connected layer with 1,024 hidden units and ReLU activation
y = layers.Dense(1024, activation='relu')(y)
# Add a dropout rate of 0.2
y = layers.Dropout(0.2)(y)                  
# Add a final sigmoid layer for classification
y = layers.Dense  (1, activation='sigmoid')(y)           

vgg16_model = Model(vgg_16.input, y) 

vgg16_model.compile(optimizer = RMSprop(lr=0.0001), 
              loss = 'binary_crossentropy', 
              metrics = ['accuracy'])

vgg16_model.summary()
```

    last layer output shape:  (None, 4, 4, 512)
    Model: "model_1"
    _________________________________________________________________
    Layer (type)                 Output Shape              Param #   
    =================================================================
    input_2 (InputLayer)         [(None, 150, 150, 3)]     0         
    _________________________________________________________________
    block1_conv1 (Conv2D)        (None, 150, 150, 64)      1792      
    _________________________________________________________________
    block1_conv2 (Conv2D)        (None, 150, 150, 64)      36928     
    _________________________________________________________________
    block1_pool (MaxPooling2D)   (None, 75, 75, 64)        0         
    _________________________________________________________________
    block2_conv1 (Conv2D)        (None, 75, 75, 128)       73856     
    _________________________________________________________________
    block2_conv2 (Conv2D)        (None, 75, 75, 128)       147584    
    _________________________________________________________________
    block2_pool (MaxPooling2D)   (None, 37, 37, 128)       0         
    _________________________________________________________________
    block3_conv1 (Conv2D)        (None, 37, 37, 256)       295168    
    _________________________________________________________________
    block3_conv2 (Conv2D)        (None, 37, 37, 256)       590080    
    _________________________________________________________________
    block3_conv3 (Conv2D)        (None, 37, 37, 256)       590080    
    _________________________________________________________________
    block3_pool (MaxPooling2D)   (None, 18, 18, 256)       0         
    _________________________________________________________________
    block4_conv1 (Conv2D)        (None, 18, 18, 512)       1180160   
    _________________________________________________________________
    block4_conv2 (Conv2D)        (None, 18, 18, 512)       2359808   
    _________________________________________________________________
    block4_conv3 (Conv2D)        (None, 18, 18, 512)       2359808   
    _________________________________________________________________
    block4_pool (MaxPooling2D)   (None, 9, 9, 512)         0         
    _________________________________________________________________
    block5_conv1 (Conv2D)        (None, 9, 9, 512)         2359808   
    _________________________________________________________________
    block5_conv2 (Conv2D)        (None, 9, 9, 512)         2359808   
    _________________________________________________________________
    block5_conv3 (Conv2D)        (None, 9, 9, 512)         2359808   
    _________________________________________________________________
    block5_pool (MaxPooling2D)   (None, 4, 4, 512)         0         
    _________________________________________________________________
    flatten_1 (Flatten)          (None, 8192)              0         
    _________________________________________________________________
    dense_2 (Dense)              (None, 1024)              8389632   
    _________________________________________________________________
    dropout_1 (Dropout)          (None, 1024)              0         
    _________________________________________________________________
    dense_3 (Dense)              (None, 1)                 1025      
    =================================================================
    Total params: 23,105,345
    Trainable params: 23,105,345
    Non-trainable params: 0
    _________________________________________________________________
    


```python
# Run this and see how many epochs it should take before the callback
# fires, and stops training at 99.9% accuracy
# (It should take less than 100 epochs)
callbacks = myCallback()
history = vgg16_model.fit(
            train_generator,
            validation_data = validation_generator,
            epochs = 5,
            verbose = 1,
            callbacks=[callbacks])



```

    Epoch 1/5
    9/9 [==============================] - 23s 1s/step - loss: 1.8346 - accuracy: 0.5057 - val_loss: 0.6203 - val_accuracy: 0.6250
    Epoch 2/5
    9/9 [==============================] - 13s 1s/step - loss: 0.8057 - accuracy: 0.5940 - val_loss: 0.5979 - val_accuracy: 0.6562
    Epoch 3/5
    9/9 [==============================] - 13s 1s/step - loss: 0.6217 - accuracy: 0.6718 - val_loss: 0.8092 - val_accuracy: 0.5820
    Epoch 4/5
    9/9 [==============================] - 14s 1s/step - loss: 0.5862 - accuracy: 0.6865 - val_loss: 0.5255 - val_accuracy: 0.7383
    Epoch 5/5
    9/9 [==============================] - 13s 1s/step - loss: 0.7840 - accuracy: 0.6615 - val_loss: 0.4724 - val_accuracy: 0.7617
    


    ---------------------------------------------------------------------------

    NameError                                 Traceback (most recent call last)

    <ipython-input-15-bc0b5f97cb2f> in <module>()
         11 
         12 
    ---> 13 _, vgg16_keras_file = tempfile.mkstemp('.h5')
         14 tf.keras.models.save_model(vgg16_model, vgg16_keras_file, include_optimizer=False)
    

    NameError: name 'tempfile' is not defined



```python
import tempfile

logdir = tempfile.mkdtemp()

_, vgg16_keras_file = tempfile.mkstemp('.h5')
tf.keras.models.save_model(vgg16_model, vgg16_keras_file, include_optimizer=False)
```


```python
import tensorflow_model_optimization as tfmot
import numpy as np

'''
pruning_schedule = tfmot.sparsity.keras.PolynomialDecay(
                        initial_sparsity=0.50, final_sparsity=0.9,
                        begin_step=0, end_step=2000)
'''
# Compute end step to finish pruning after 2 epochs.
batch_size = 128
epochs = 5
validation_split = 0.2 # 10% of training set will be used for validation set. 

num_images = 1027 # num_images = train_images.shape[0] * (1 - validation_split)
end_step = np.ceil(num_images / batch_size).astype(np.int32) * epochs

new_pruning_params = {
      'pruning_schedule': tfmot.sparsity.keras.PolynomialDecay(initial_sparsity=0.50,
                                                   final_sparsity=0.85,
                                                   begin_step=0,
                                                   end_step=end_step,
                                                   frequency=1
                                                   )
}

vgg16_model_for_pruning = tfmot.sparsity.keras.prune_low_magnitude(vgg16_model, **new_pruning_params)




vgg16_model_for_pruning.compile(optimizer = RMSprop(lr=0.0001), 
              loss = 'binary_crossentropy', 
              metrics = ['accuracy'])

# Requirement for the vgg16_model_for_pruning

import tempfile

logdir = tempfile.mkdtemp()

callbacks = [
  tfmot.sparsity.keras.UpdatePruningStep(),
  tfmot.sparsity.keras.PruningSummaries(log_dir=logdir),
]

vgg16_model_for_pruning.fit(train_generator,
            validation_data = validation_generator,
            epochs = 5,
            verbose = 1,
            callbacks=[callbacks])

vgg16_model_for_export = tfmot.sparsity.keras.strip_pruning(vgg16_model_for_pruning)

#model_for_export.summary()


_, vgg16_pruned_keras_file_1 = tempfile.mkstemp('.h5')
tf.keras.models.save_model(vgg16_model_for_export, vgg16_pruned_keras_file_1, include_optimizer=False)


```

    /usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/engine/base_layer.py:2281: UserWarning: `layer.add_variable` is deprecated and will be removed in a future version. Please use `layer.add_weight` method instead.
      warnings.warn('`layer.add_variable` is deprecated and '
    

    Epoch 1/5
    9/9 [==============================] - 21s 2s/step - loss: 0.7631 - accuracy: 0.8538 - val_loss: 18.3903 - val_accuracy: 0.5430
    Epoch 2/5
    9/9 [==============================] - 14s 1s/step - loss: 1.7532 - accuracy: 0.5897 - val_loss: 0.6008 - val_accuracy: 0.7656
    Epoch 3/5
    9/9 [==============================] - 14s 2s/step - loss: 0.8911 - accuracy: 0.6538 - val_loss: 0.5218 - val_accuracy: 0.7852
    Epoch 4/5
    9/9 [==============================] - 14s 2s/step - loss: 0.6537 - accuracy: 0.6605 - val_loss: 1.3392 - val_accuracy: 0.5742
    Epoch 5/5
    9/9 [==============================] - 14s 2s/step - loss: 0.4676 - accuracy: 0.7795 - val_loss: 2.2356 - val_accuracy: 0.6758
    


```python
def get_gzipped_model_size(file):
  # Returns size of gzipped model, in bytes.
  import os
  import zipfile

  _, zipped_file = tempfile.mkstemp('.zip')
  with zipfile.ZipFile(zipped_file, 'w', compression=zipfile.ZIP_DEFLATED) as f:
    f.write(file)

  return os.path.getsize(zipped_file)


print("Size of gzipped baseline Keras model: %.2f bytes" % (get_gzipped_model_size(vgg16_keras_file)))
print("Size of gzipped pruned Keras model: %.2f bytes" % (get_gzipped_model_size(vgg16_pruned_keras_file_1)))
```

    Size of gzipped baseline Keras model: 85418562.00 bytes
    Size of gzipped pruned Keras model: 22220306.00 bytes
    


```python
from tensorflow.keras.models import load_model

model = load_model(vgg16_pruned_keras_file_1)
import numpy as np

for i, w in enumerate(model.get_weights()):
    print(
        "{} -- Total:{}, Zeros: {:.2f}%".format(
            model.weights[i].name, w.size, np.sum(w == 0) / w.size * 100
        )
    )
```

    WARNING:tensorflow:No training configuration found in the save file, so the model was *not* compiled. Compile it manually.
    block1_conv1/kernel:0 -- Total:1728, Zeros: 85.01%
    block1_conv1/bias:0 -- Total:64, Zeros: 0.00%
    block1_conv2/kernel:0 -- Total:36864, Zeros: 85.00%
    block1_conv2/bias:0 -- Total:64, Zeros: 0.00%
    block2_conv1/kernel:0 -- Total:73728, Zeros: 85.00%
    block2_conv1/bias:0 -- Total:128, Zeros: 0.00%
    block2_conv2/kernel:0 -- Total:147456, Zeros: 85.00%
    block2_conv2/bias:0 -- Total:128, Zeros: 0.00%
    block3_conv1/kernel:0 -- Total:294912, Zeros: 85.00%
    block3_conv1/bias:0 -- Total:256, Zeros: 0.00%
    block3_conv2/kernel:0 -- Total:589824, Zeros: 85.00%
    block3_conv2/bias:0 -- Total:256, Zeros: 0.00%
    block3_conv3/kernel:0 -- Total:589824, Zeros: 85.00%
    block3_conv3/bias:0 -- Total:256, Zeros: 0.00%
    block4_conv1/kernel:0 -- Total:1179648, Zeros: 85.00%
    block4_conv1/bias:0 -- Total:512, Zeros: 0.00%
    block4_conv2/kernel:0 -- Total:2359296, Zeros: 85.00%
    block4_conv2/bias:0 -- Total:512, Zeros: 0.00%
    block4_conv3/kernel:0 -- Total:2359296, Zeros: 85.00%
    block4_conv3/bias:0 -- Total:512, Zeros: 0.00%
    block5_conv1/kernel:0 -- Total:2359296, Zeros: 85.00%
    block5_conv1/bias:0 -- Total:512, Zeros: 0.00%
    block5_conv2/kernel:0 -- Total:2359296, Zeros: 85.00%
    block5_conv2/bias:0 -- Total:512, Zeros: 0.00%
    block5_conv3/kernel:0 -- Total:2359296, Zeros: 85.00%
    block5_conv3/bias:0 -- Total:512, Zeros: 0.00%
    dense_2/kernel:0 -- Total:8388608, Zeros: 85.00%
    dense_2/bias:0 -- Total:1024, Zeros: 0.20%
    dense_3/kernel:0 -- Total:1024, Zeros: 84.96%
    dense_3/bias:0 -- Total:1, Zeros: 0.00%
    


```python
import tensorflow as tf


converter = tf.lite.TFLiteConverter.from_keras_model(vgg16_model)
converter.optimizations = [tf.lite.Optimize.DEFAULT]
tflite_quant_model = converter.convert()

open("vgg16_converted_model.tflite", "wb").write(tflite_quant_model)

print("Size of gzipped baseline Keras model: %.2f bytes" % (os.path.getsize("converted_model.tflite")))



converter = tf.lite.TFLiteConverter.from_keras_model(vgg16_model)
converter.optimizations = [tf.lite.Optimize.DEFAULT]
tflite_quant_model = converter.convert()

open("vgg16_converted_model.tflite", "wb").write(tflite_quant_model)

print("Size of gzipped baseline Keras model: %.2f bytes" % (os.path.getsize("converted_model.tflite")))
```


```python

```


```python

```


```python

```

# Testing 


```python
import tempfile
import os

import tensorflow as tf
import numpy as np

from tensorflow import keras

%load_ext tensorboard

# Load MNIST dataset
mnist = keras.datasets.mnist
(train_images, train_labels), (test_images, test_labels) = mnist.load_data()

# Normalize the input image so that each pixel value is between 0 to 1.
train_images = train_images / 255.0
test_images = test_images / 255.0

# Define the model architecture.
model = keras.Sequential([
  keras.layers.InputLayer(input_shape=(28, 28)),
  keras.layers.Reshape(target_shape=(28, 28, 1)),
  keras.layers.Conv2D(filters=12, kernel_size=(3, 3), activation='relu'),
  keras.layers.MaxPooling2D(pool_size=(2, 2)),
  keras.layers.Flatten(),
  keras.layers.Dense(10)
])

# Train the digit classification model
model.compile(optimizer='adam',
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),
              metrics=['accuracy'])

model.fit(
  train_images,
  train_labels,
  epochs=4,
  validation_split=0.1,
)
```

    Downloading data from https://storage.googleapis.com/tensorflow/tf-keras-datasets/mnist.npz
    11493376/11490434 [==============================] - 0s 0us/step
    Epoch 1/4
    1688/1688 [==============================] - 12s 3ms/step - loss: 0.5199 - accuracy: 0.8538 - val_loss: 0.1142 - val_accuracy: 0.9710
    Epoch 2/4
    1688/1688 [==============================] - 4s 2ms/step - loss: 0.1248 - accuracy: 0.9637 - val_loss: 0.0805 - val_accuracy: 0.9790
    Epoch 3/4
    1688/1688 [==============================] - 4s 2ms/step - loss: 0.0884 - accuracy: 0.9745 - val_loss: 0.0700 - val_accuracy: 0.9808
    Epoch 4/4
    1688/1688 [==============================] - 4s 2ms/step - loss: 0.0701 - accuracy: 0.9800 - val_loss: 0.0664 - val_accuracy: 0.9815
    




    <tensorflow.python.keras.callbacks.History at 0x7f1fa462d160>




```python
_, baseline_model_accuracy = model.evaluate(
    test_images, test_labels, verbose=0)

print('Baseline test accuracy:', baseline_model_accuracy)

_, keras_file = tempfile.mkstemp('.h5')
tf.keras.models.save_model(model, keras_file, include_optimizer=False)
print('Saved baseline model to:', keras_file)
```

    Baseline test accuracy: 0.9772999882698059
    Saved baseline model to: /tmp/tmpp8x7df_2.h5
    


```python
import tensorflow_model_optimization as tfmot

prune_low_magnitude = tfmot.sparsity.keras.prune_low_magnitude

# Compute end step to finish pruning after 2 epochs.
batch_size = 128
epochs = 2
validation_split = 0.1 # 10% of training set will be used for validation set. 

num_images = train_images.shape[0] * (1 - validation_split)
end_step = np.ceil(num_images / batch_size).astype(np.int32) * epochs

# Define model for pruning.
pruning_params = {
      'pruning_schedule': tfmot.sparsity.keras.PolynomialDecay(initial_sparsity=0.50,
                                                               final_sparsity=0.80,
                                                               begin_step=0,
                                                               end_step=end_step)
}

model_for_pruning = prune_low_magnitude(model, **pruning_params)
}
# `prune_low_magnitude` requires a recompile.
model_for_pruning.compile(optimizer='adam',
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),
              metrics=['accuracy'])

model_for_pruning.summary()
```


      File "<ipython-input-1-f8928b68815c>", line 22
        }
        ^
    SyntaxError: invalid syntax
    



```python
logdir = tempfile.mkdtemp()

callbacks = [
  tfmot.sparsity.keras.UpdatePruningStep(),
  tfmot.sparsity.keras.PruningSummaries(log_dir=logdir),
]

model_for_pruning.fit(train_images, train_labels,
                  batch_size=batch_size, epochs=epochs, validation_split=validation_split,
                  callbacks=callbacks)
```


    ---------------------------------------------------------------------------

    NameError                                 Traceback (most recent call last)

    <ipython-input-2-c77e1c0abaf3> in <module>()
    ----> 1 logdir = tempfile.mkdtemp()
          2 
          3 callbacks = [
          4   tfmot.sparsity.keras.UpdatePruningStep(),
          5   tfmot.sparsity.keras.PruningSummaries(log_dir=logdir),
    

    NameError: name 'tempfile' is not defined



```python
_, model_for_pruning_accuracy = model_for_pruning.evaluate(
   test_images, test_labels, verbose=0)

print('Baseline test accuracy:', baseline_model_accuracy) 
print('Pruned test accuracy:', model_for_pruning_accuracy)

%tensorboard --logdir={logdir}
```


```python
model_for_export = tfmot.sparsity.keras.strip_pruning(model_for_pruning)

_, pruned_keras_file = tempfile.mkstemp('.h5')
tf.keras.models.save_model(model_for_export, pruned_keras_file, include_optimizer=False)
print('Saved pruned Keras model to:', pruned_keras_file)
```

    Saved pruned Keras model to: /tmp/tmpn2hl0my9.h5
    


```python
def get_gzipped_model_size(file):
  # Returns size of gzipped model, in bytes.
  import os
  import zipfile

  _, zipped_file = tempfile.mkstemp('.zip')
  with zipfile.ZipFile(zipped_file, 'w', compression=zipfile.ZIP_DEFLATED) as f:
    f.write(file)

  return os.path.getsize(zipped_file)


print("Size of gzipped baseline Keras model: %.2f bytes" % (get_gzipped_model_size(keras_file)))
print("Size of gzipped pruned Keras model: %.2f bytes" % (get_gzipped_model_size(pruned_keras_file)))
```

    Size of gzipped baseline Keras model: 78138.00 bytes
    Size of gzipped pruned Keras model: 25853.00 bytes
    


```python
import tensorflow_model_optimization as tfmot

prune_low_magnitude = tfmot.sparsity.keras.prune_low_magnitude

'''
pruning_schedule = tfmot.sparsity.keras.PolynomialDecay(
                        initial_sparsity=0.50, final_sparsity=0.9,
                        begin_step=0, end_step=2000)
'''

# Compute end step to finish pruning after 2 epochs.
batch_size = 128
epochs = 5
validation_split = 0.2 # 10% of training set will be used for validation set. 

num_images = 500 * (1 - validation_split) # num_images = train_images.shape[0] * (1 - validation_split)
end_step = np.ceil(num_images / batch_size).astype(np.int32) * epochs


# the only difference here is final_sparsity  0.9 instead of 0.8
pruning_params = {
      'pruning_schedule': tfmot.sparsity.keras.PolynomialDecay(initial_sparsity=0.50,
                                                               final_sparsity=0.80,
                                                               begin_step=0,
                                                               end_step=end_step)
}

model_for_pruning = prune_low_magnitude(model, **pruning_params)


model_for_pruning = tfmot.sparsity.keras.prune_low_magnitude(model, **new_pruning_params)



model_for_pruning.compile(optimizer = RMSprop(lr=0.0001), 
              loss = 'binary_crossentropy', 
              metrics = ['accuracy'])

'''
# `prune_low_magnitude` requires a recompile.
model_for_pruning.compile(optimizer='adam',
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),
              metrics=['accuracy'])
'''


model_for_pruning.summary()

# Requirement for the vgg16_model_for_pruning

import tempfile

logdir = tempfile.mkdtemp()

callbacks = [
  tfmot.sparsity.keras.UpdatePruningStep(),
  tfmot.sparsity.keras.PruningSummaries(log_dir=logdir),
]

model_for_pruning.fit(train_images, train_labels, epochs=5, validation_split=0.1,
                  callbacks=callbacks)


model_for_export = tfmot.sparsity.keras.strip_pruning(model_for_pruning)

#model_for_export.summary()

_, pruned_keras_file = tempfile.mkstemp('.h5')
tf.keras.models.save_model(model_for_export, pruned_keras_file, include_optimizer=False)

def get_gzipped_model_size(file):
  # Returns size of gzipped model, in bytes.
  import os
  import zipfile

  _, zipped_file = tempfile.mkstemp('.zip')
  with zipfile.ZipFile(zipped_file, 'w', compression=zipfile.ZIP_DEFLATED) as f:
    f.write(file)

  return os.path.getsize(zipped_file)


print("Size of gzipped baseline Keras model: %.2f bytes" % (get_gzipped_model_size(keras_file)))
print("Size of gzipped pruned Keras model: %.2f bytes" % (get_gzipped_model_size(pruned_keras_file)))
```

    /usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/engine/base_layer.py:2281: UserWarning: `layer.add_variable` is deprecated and will be removed in a future version. Please use `layer.add_weight` method instead.
      warnings.warn('`layer.add_variable` is deprecated and '
    

    Model: "sequential_2"
    _________________________________________________________________
    Layer (type)                 Output Shape              Param #   
    =================================================================
    prune_low_magnitude_reshape_ (None, 28, 28, 1)         1         
    _________________________________________________________________
    prune_low_magnitude_conv2d_9 (None, 26, 26, 12)        230       
    _________________________________________________________________
    prune_low_magnitude_max_pool (None, 13, 13, 12)        1         
    _________________________________________________________________
    prune_low_magnitude_flatten_ (None, 2028)              1         
    _________________________________________________________________
    prune_low_magnitude_dense_10 (None, 10)                40572     
    =================================================================
    Total params: 40,805
    Trainable params: 20,410
    Non-trainable params: 20,395
    _________________________________________________________________
    Epoch 1/5
       3/1688 [..............................] - ETA: 3:12 - loss: 49.9961 - accuracy: 0.9340WARNING:tensorflow:Callback method `on_train_batch_end` is slow compared to the batch time (batch time: 0.0058s vs `on_train_batch_end` time: 0.0355s). Check your callbacks.
    

    WARNING:tensorflow:Callback method `on_train_batch_end` is slow compared to the batch time (batch time: 0.0058s vs `on_train_batch_end` time: 0.0355s). Check your callbacks.
    

    1688/1688 [==============================] - 14s 7ms/step - loss: 42.7515 - accuracy: 0.8144 - val_loss: -2.4288 - val_accuracy: 0.1087
    Epoch 2/5
    1688/1688 [==============================] - 13s 7ms/step - loss: -7.3549 - accuracy: 0.1160 - val_loss: -15.8650 - val_accuracy: 0.1085
    Epoch 3/5
    1688/1688 [==============================] - 12s 7ms/step - loss: -17.6041 - accuracy: 0.1169 - val_loss: -23.1318 - val_accuracy: 0.1065
    Epoch 4/5
    1688/1688 [==============================] - 12s 7ms/step - loss: -24.1439 - accuracy: 0.1162 - val_loss: -27.1808 - val_accuracy: 0.1057
    Epoch 5/5
    1688/1688 [==============================] - 13s 8ms/step - loss: -27.2478 - accuracy: 0.1138 - val_loss: -28.1653 - val_accuracy: 0.1055
    Size of gzipped baseline Keras model: 78138.00 bytes
    Size of gzipped pruned Keras model: 16964.00 bytes
    


```python


print("Size of gzipped baseline Keras model: %.2f bytes" % (get_gzipped_model_size(keras_file)))
```

    Size of gzipped baseline Keras model: 78138.00 bytes
    


```python
model.summary()
```

    Model: "sequential"
    _________________________________________________________________
    Layer (type)                 Output Shape              Param #   
    =================================================================
    reshape (Reshape)            (None, 28, 28, 1)         0         
    _________________________________________________________________
    conv2d (Conv2D)              (None, 26, 26, 12)        120       
    _________________________________________________________________
    max_pooling2d (MaxPooling2D) (None, 13, 13, 12)        0         
    _________________________________________________________________
    flatten (Flatten)            (None, 2028)              0         
    _________________________________________________________________
    dense (Dense)                (None, 10)                20290     
    =================================================================
    Total params: 20,410
    Trainable params: 20,410
    Non-trainable params: 0
    _________________________________________________________________
    


```python
model.summary()

for layer in model.layers:
    # check for convolutional layer
    if 'conv' not in layer.name:
      continue
    # get filter weights
    filters, biases = layer.get_weights()
    print(layer.name, filters.shape)
```

    Model: "sequential"
    _________________________________________________________________
    Layer (type)                 Output Shape              Param #   
    =================================================================
    reshape (Reshape)            (None, 28, 28, 1)         0         
    _________________________________________________________________
    conv2d (Conv2D)              (None, 26, 26, 12)        120       
    _________________________________________________________________
    max_pooling2d (MaxPooling2D) (None, 13, 13, 12)        0         
    _________________________________________________________________
    flatten (Flatten)            (None, 2028)              0         
    _________________________________________________________________
    dense (Dense)                (None, 10)                20290     
    =================================================================
    Total params: 20,410
    Trainable params: 20,410
    Non-trainable params: 0
    _________________________________________________________________
    conv2d (3, 3, 1, 12)
    


```python
dense, biases = model.layers[-1].get_weights()

# print(dense)

#print(len(dense[0]))

for i in range(len(dense)):
  for j in range(len(dense[0])):
    if((i+j) % 2 != 0):
      dense[i][j] = 0

print(dense)
```

    [[ 0.01524631  0.          0.00111699 ...  0.         -0.06358791
       0.        ]
     [ 0.          0.19251888  0.         ...  0.04886151  0.
      -0.04353621]
     [ 0.02915934  0.         -0.00266293 ...  0.         -0.02883248
       0.        ]
     ...
     [ 0.          0.25342146  0.         ...  0.05792155  0.
      -0.02182929]
     [-0.14020655  0.          0.00622205 ...  0.         -0.14786795
       0.        ]
     [ 0.         -0.05931381  0.         ... -0.03101994  0.
       0.00539972]]
    


```python
model.layers[-1].set_weights([dense, biases])
```


```python
dense, biases = model.layers[-1].get_weights()
print(dense)
```

    [[ 0.01524631  0.          0.00111699 ...  0.         -0.06358791
       0.        ]
     [ 0.          0.19251888  0.         ...  0.04886151  0.
      -0.04353621]
     [ 0.02915934  0.         -0.00266293 ...  0.         -0.02883248
       0.        ]
     ...
     [ 0.          0.25342146  0.         ...  0.05792155  0.
      -0.02182929]
     [-0.14020655  0.          0.00622205 ...  0.         -0.14786795
       0.        ]
     [ 0.         -0.05931381  0.         ... -0.03101994  0.
       0.00539972]]
    


```python
type(dense)
```




    numpy.ndarray




```python

```
